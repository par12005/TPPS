
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.3. Login and Profile &#8212; Tripal Plant PopGen Submit  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.4. Publication and Species Interface" href="page_1.html" />
    <link rel="prev" title="3.2. Configuration" href="../config.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="login-and-profile">
<h1>3.3. Login and Profile<a class="headerlink" href="#login-and-profile" title="Permalink to this headline">Â¶</a></h1>
<p>Users can only access the TPPS form while they are logged into their Tripal account. This is so that a user can pick up where they left off, should they need to make their submission over multiple sessions. For example, if a user is submitting data through TPPS, then realizes that they need to collect some additional information before completing their submission, they can leave the TreeGenes site to collect their additional information, and when they return, all of the data that user entered previously will be stored on TreeGenes, and the user will not need to fill out all of the form fields again.</p>
<p>Checking if the user is logged in, loading relevant submissions, and redirecting or displaying the correct form is handled in the following snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>function tpps_master($form, &amp;$form_state){

    global $user;
    $params = drupal_get_query_parameters();

    if (!isset($user-&gt;mail) and !isset($form_state[&#39;stage&#39;])){
        //first access, not logged in
        $form_state[&#39;stage&#39;] = &#39;frontpage&#39;;

        front_create_form($form, $form_state);

        drupal_add_js(drupal_get_path(&#39;module&#39;, &#39;tpps&#39;) . &quot;/tpps.js&quot;);

        return $form;
    }
    elseif (!isset($user-&gt;mail)){
        //not first access, but not logged in
        $destination = drupal_get_destination();
        drupal_goto(&#39;user/login&#39;, array(&#39;query&#39; =&gt; $destination));
    }
    elseif (isset($params[&#39;accession&#39;]) and !isset($form_state[&#39;stage&#39;])) {
        //logged in, and with accession number in link
        $old_form_state = variable_get(&#39;tpps_incomplete_&#39; . $user-&gt;mail . $params[&#39;accession&#39;]);
        $form_state[&#39;saved_values&#39;] = $old_form_state[&#39;saved_values&#39;];
        $form_state[&#39;stage&#39;] = $old_form_state[&#39;stage&#39;];
        $form_state[&#39;accession&#39;] = $old_form_state[&#39;accession&#39;];
        $form_state[&#39;dbxref_id&#39;] = $old_form_state[&#39;dbxref_id&#39;];
    }
    else {
        //logged in, with plain link
        if (!isset($form_state[&#39;stage&#39;])){
            //first access
            $form_state[&#39;stage&#39;] = &#39;frontpage&#39;;

            front_create_form($form, $form_state);

            drupal_add_js(drupal_get_path(&#39;module&#39;, &#39;tpps&#39;) . &quot;/tpps.js&quot;);

            return $form;
        }
        else {
            //not first access
            if (!isset($form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;]) or (isset($form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;]) and $form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;] === &#39;new&#39;)){
                //no submissions, or selected to create new submission
                tpps_init_project($form, $form_state);
                variable_set(&#39;tpps_incomplete_&#39; . $user-&gt;mail . $form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;], $form_state);
            }
            $old_form_state = variable_get(&#39;tpps_incomplete_&#39; . $user-&gt;mail . $form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;]);
            $form_state[&#39;saved_values&#39;] = $old_form_state[&#39;saved_values&#39;];
            $form_state[&#39;stage&#39;] = $old_form_state[&#39;stage&#39;];
            $form_state[&#39;accession&#39;] = $old_form_state[&#39;accession&#39;];
            $form_state[&#39;dbxref_id&#39;] = $old_form_state[&#39;dbxref_id&#39;];
        }
    }

//$form_state was loaded from saved variable, continue defining the form based on $form_state
...
}
</pre></div>
</div>
<p>If the user is not logged in, they are redirected to the login page, where they can login as an existing user or sign up to create a new account.</p>
<p>If the user is logged in, and they have any incomplete TPPS Submissions, they will be given the option to continue with one of their old submissions, or create a new TPPS Submission.</p>
<p>A screenshot of the landing page for a logged in user with a submission in progress can be seen below</p>
<img alt="../_images/TPPS_landing.png" src="../_images/TPPS_landing.png" />
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Tripal Plant PopGen Submit</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Sections:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">2. Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../admin.html">3. Administrators</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install.html">3.1. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html">3.2. Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. Login and Profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_1.html">3.4. Publication and Species Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_2.html">3.5. Study Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_3.html">3.6. Tree Accession</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_4.html">3.7. Genotype, Phenotype, and Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">3.8. Submission Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../valid.html">3.9. Input Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../submit.html">3.10. Data Submission</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user.html">4. Users</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../admin.html">3. Administrators</a><ul>
      <li>Previous: <a href="../config.html" title="previous chapter">3.2. Configuration</a></li>
      <li>Next: <a href="page_1.html" title="next chapter">3.4. Publication and Species Interface</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Peter Richter.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../_sources/admin_pages/login.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>