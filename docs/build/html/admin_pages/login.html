

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.3. Login and Profile &mdash; Tripal Plant PopGen Submit  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.4. Publication and Species Interface" href="page_1.html" />
    <link rel="prev" title="3.2. Configuration" href="../config.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Tripal Plant PopGen Submit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">2. Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../admin.html">3. Administrators</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install.html">3.1. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html">3.2. Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. Login and Profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_1.html">3.4. Publication and Species Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_2.html">3.5. Study Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_3.html">3.6. Tree Accession</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_4.html">3.7. Genotype, Phenotype, and Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">3.8. Submission Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../valid.html">3.9. Input Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../submit.html">3.10. Data Submission</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user.html">4. Users</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Tripal Plant PopGen Submit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../admin.html">3. Administrators</a> &raquo;</li>
        
      <li>3.3. Login and Profile</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://gitlab.com/TreeGenes/TGDR/blob/master/docs/source/admin_pages/login.rst" class="fa fa-gitlab"> Edit on GitLab</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="login-and-profile">
<h1>3.3. Login and Profile<a class="headerlink" href="#login-and-profile" title="Permalink to this headline">Â¶</a></h1>
<p>Users can only access the TPPS form while they are logged into their Tripal account. This is so that a user can pick up where they left off, should they need to make their submission over multiple sessions. For example, if a user is submitting data through TPPS, then realizes that they need to collect some additional information before completing their submission, they can leave the TreeGenes site to collect their additional information, and when they return, all of the data that user entered previously will be stored on TreeGenes, and the user will not need to fill out all of the form fields again.</p>
<p>Checking if the user is logged in, loading relevant submissions, and redirecting or displaying the correct form is handled in the following snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>function tpps_master($form, &amp;$form_state){

    global $user;
    $params = drupal_get_query_parameters();

    if (!isset($user-&gt;mail) and !isset($form_state[&#39;stage&#39;])){
        //first access, not logged in
        $form_state[&#39;stage&#39;] = &#39;frontpage&#39;;

        front_create_form($form, $form_state);

        drupal_add_js(drupal_get_path(&#39;module&#39;, &#39;tpps&#39;) . &quot;/tpps.js&quot;);

        return $form;
    }
    elseif (!isset($user-&gt;mail)){
        //not first access, but not logged in
        $destination = drupal_get_destination();
        drupal_goto(&#39;user/login&#39;, array(&#39;query&#39; =&gt; $destination));
    }
    elseif (isset($params[&#39;accession&#39;]) and !isset($form_state[&#39;stage&#39;])) {
        //logged in, and with accession number in link
        $old_form_state = variable_get(&#39;tpps_incomplete_&#39; . $user-&gt;mail . $params[&#39;accession&#39;]);
        $form_state[&#39;saved_values&#39;] = $old_form_state[&#39;saved_values&#39;];
        $form_state[&#39;stage&#39;] = $old_form_state[&#39;stage&#39;];
        $form_state[&#39;accession&#39;] = $old_form_state[&#39;accession&#39;];
        $form_state[&#39;dbxref_id&#39;] = $old_form_state[&#39;dbxref_id&#39;];
    }
    else {
        //logged in, with plain link
        if (!isset($form_state[&#39;stage&#39;])){
            //first access
            $form_state[&#39;stage&#39;] = &#39;frontpage&#39;;

            front_create_form($form, $form_state);

            drupal_add_js(drupal_get_path(&#39;module&#39;, &#39;tpps&#39;) . &quot;/tpps.js&quot;);

            return $form;
        }
        else {
            //not first access
            if (!isset($form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;]) or (isset($form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;]) and $form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;] === &#39;new&#39;)){
                //no submissions, or selected to create new submission
                tpps_init_project($form, $form_state);
                variable_set(&#39;tpps_incomplete_&#39; . $user-&gt;mail . $form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;], $form_state);
            }
            $old_form_state = variable_get(&#39;tpps_incomplete_&#39; . $user-&gt;mail . $form_state[&#39;saved_values&#39;][&#39;frontpage&#39;][&#39;accession&#39;]);
            $form_state[&#39;saved_values&#39;] = $old_form_state[&#39;saved_values&#39;];
            $form_state[&#39;stage&#39;] = $old_form_state[&#39;stage&#39;];
            $form_state[&#39;accession&#39;] = $old_form_state[&#39;accession&#39;];
            $form_state[&#39;dbxref_id&#39;] = $old_form_state[&#39;dbxref_id&#39;];
        }
    }

//$form_state was loaded from saved variable, continue defining the form based on $form_state
...
}
</pre></div>
</div>
<p>If the user is not logged in, they are redirected to the login page, where they can login as an existing user or sign up to create a new account.</p>
<p>If the user is logged in, and they have any incomplete TPPS Submissions, they will be given the option to continue with one of their old submissions, or create a new TPPS Submission.</p>
<p>A screenshot of the landing page for a logged in user with a submission in progress can be seen below</p>
<img alt="../_images/TPPS_landing.png" src="../_images/TPPS_landing.png" />
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="page_1.html" class="btn btn-neutral float-right" title="3.4. Publication and Species Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../config.html" class="btn btn-neutral" title="3.2. Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Peter Richter.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>