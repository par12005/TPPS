<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tripal Plant PopGen Submit: /var/www/html/sites/all/modules/TGDR/forms/build/page_3.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tripal Plant PopGen Submit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('build_2page__3_8php_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">page_3.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="build_2page__3_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;require_once <span class="stringliteral">&#39;page_3_ajax.php&#39;</span>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;require_once <span class="stringliteral">&#39;page_3_helper.php&#39;</span>;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="build_2page__3_8php.html#af344aedb3f06c89a02a5d26f932169b3">   24</a></span>&#160;<span class="keyword">function</span> <a class="code" href="build_2page__3_8php.html#af344aedb3f06c89a02a5d26f932169b3">tpps_page_3_create_form</a>(array &amp;$form, array &amp;$form_state) {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordflow">if</span> (isset($form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a>])) {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    $values = $form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a>];</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  }</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    $values = array();</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  }</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">if</span> ($form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#abbdd730f35d5b6b69523d04594326f13">TPPS_PAGE_2</a>][<span class="stringliteral">&#39;study_type&#39;</span>] != 1) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="page__3__helper_8php.html#ac941b31acff40a333b85240d6c9980c5">tpps_study_location</a>($form, $form_state);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  }</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  $form[<span class="stringliteral">&#39;existing_trees&#39;</span>] = array(</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;checkbox&#39;</span>,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;These plants may have been studied in the past&#39;</span>),</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="stringliteral">&#39;#description&#39;</span> =&gt; t(<span class="stringliteral">&#39;If this box is checked, TPPS will try to find plants with matching ids around the same location as the ones you are providing. If it finds them successfully, it will mark them as the same plant in the database.&#39;</span>),</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  );</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="tpps_8module.html#ab6d360adf17e04ae1e28c082a3f84cc4">tpps_access</a>(<span class="stringliteral">&#39;administer tpps module&#39;</span>)) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    $form[<span class="stringliteral">&#39;skip_validation&#39;</span>] = array(</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;checkbox&#39;</span>,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;Skip location validation (ignore location information)&#39;</span>),</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    );</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  $form[<span class="stringliteral">&#39;tree-accession&#39;</span>] = array(</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;fieldset&#39;</span>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;Plant Accession Information&#39;</span>),</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="stringliteral">&#39;#tree&#39;</span> =&gt; TRUE,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="stringliteral">&#39;#prefix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;div id=&quot;tpps_accession&quot;&gt;&#39;</span>,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="stringliteral">&#39;#suffix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  );</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  $species_number = $form_state[<span class="stringliteral">&#39;stats&#39;</span>][<span class="stringliteral">&#39;species_count&#39;</span>];</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> ($species_number &gt; 1) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Create the single/multiple file checkbox.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&#39;check&#39;</span>] = array(</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;checkbox&#39;</span>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;I would like to upload a separate plant accession file for each species.&#39;</span>),</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="stringliteral">&#39;#ajax&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="stringliteral">&#39;wrapper&#39;</span> =&gt; <span class="stringliteral">&#39;tpps_accession&#39;</span>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="stringliteral">&#39;callback&#39;</span> =&gt; <span class="stringliteral">&#39;tpps_accession_multi_file&#39;</span>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      ),</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    );</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  $file_description = <span class="stringliteral">&quot;Please upload a spreadsheet file containing plant population data. When your file is uploaded, you will be shown a table with your column header names, several drop-downs, and the first few rows of your file. You will be asked to define the data type for each column, using the drop-downs provided to you. If a column data type does not fit any of the options in the drop-down menu, you may omit that drop-down menu. Your file must contain columns with information about at least the Plant Identifier and the Location of the plant (either gps coordinates or country/state).&quot;</span>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  $file_upload_location = <span class="stringliteral">&#39;public://&#39;</span> . variable_get(<span class="stringliteral">&#39;tpps_accession_files_dir&#39;</span>, <span class="stringliteral">&#39;tpps_accession&#39;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> ($form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#abbdd730f35d5b6b69523d04594326f13">TPPS_PAGE_2</a>][<span class="stringliteral">&#39;study_type&#39;</span>] == <span class="charliteral">&#39;4&#39;</span>) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    $file_description .= <span class="stringliteral">&#39; Location columns should describe the location of the source plant for the Common Garden.&#39;</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span> ($species_number &gt; 1) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    $file_description .= <span class="stringliteral">&quot; If you are uploading a single file with multiple species, your file must also specify the genus and species of each plant.&quot;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  $image_path = drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>, <span class="stringliteral">&#39;tpps&#39;</span>) . <span class="stringliteral">&#39;/images/&#39;</span>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  $file_description .= <span class="stringliteral">&quot;Please find an example of an accession file below.&lt;figure&gt;&lt;img src=\&quot;/{$image_path}accession_example.png\&quot;&gt;&lt;figcaption&gt;Example Accession File&lt;/figcaption&gt;&lt;/figure&gt;&quot;</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  $check = <a class="code" href="form__utils_8inc.html#a5a7ccf132e84718748575e17ce306024">tpps_get_ajax_value</a>($form_state, array(<span class="stringliteral">&#39;tree-accession&#39;</span>, <span class="stringliteral">&#39;check&#39;</span>), NULL);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">for</span> ($i = 1; $i &lt;= $species_number; $i++) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    $name = $form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#afc7626d0d50cc6f3389e67ff010c6d23">TPPS_PAGE_1</a>][<span class="stringliteral">&#39;organism&#39;</span>][<span class="stringliteral">&quot;$i&quot;</span>];</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    $id_name = implode(<span class="stringliteral">&quot;_&quot;</span>, explode(<span class="stringliteral">&quot; &quot;</span>, $name));</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    $column_options = array(</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="charliteral">&#39;0&#39;</span> =&gt; <span class="stringliteral">&#39;N/A&#39;</span>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="charliteral">&#39;1&#39;</span> =&gt; <span class="stringliteral">&#39;Plant Identifier&#39;</span>,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="charliteral">&#39;2&#39;</span> =&gt; <span class="stringliteral">&#39;Country&#39;</span>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="charliteral">&#39;3&#39;</span> =&gt; <span class="stringliteral">&#39;State&#39;</span>,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="charliteral">&#39;4&#39;</span> =&gt; <span class="stringliteral">&#39;Latitude&#39;</span>,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="charliteral">&#39;5&#39;</span> =&gt; <span class="stringliteral">&#39;Longitude&#39;</span>,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="charliteral">&#39;8&#39;</span> =&gt; <span class="stringliteral">&#39;County&#39;</span>,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="charliteral">&#39;9&#39;</span> =&gt; <span class="stringliteral">&#39;District&#39;</span>,</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="stringliteral">&#39;12&#39;</span> =&gt; <span class="stringliteral">&#39;Population Group&#39;</span>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="stringliteral">&#39;13&#39;</span> =&gt; <span class="stringliteral">&#39;Clone Number&#39;</span>,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    );</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    $title = t(<span class="stringliteral">&quot;@name Accession File: *&quot;</span>, array(<span class="stringliteral">&#39;@name&#39;</span> =&gt; $name)) . <span class="stringliteral">&quot;&lt;br&gt;$file_description&quot;</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> ($species_number &gt; 1 and !$check) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      $title = t(<span class="stringliteral">&#39;Plant Accession File: *&#39;</span>) . <span class="stringliteral">&quot;&lt;br&gt;$file_description&quot;</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      $column_options[<span class="charliteral">&#39;6&#39;</span>] = <span class="stringliteral">&#39;Genus&#39;</span>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      $column_options[<span class="charliteral">&#39;7&#39;</span>] = <span class="stringliteral">&#39;Species&#39;</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      $column_options[<span class="stringliteral">&#39;10&#39;</span>] = <span class="stringliteral">&#39;Genus + Species&#39;</span>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> ($form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#abbdd730f35d5b6b69523d04594326f13">TPPS_PAGE_2</a>][<span class="stringliteral">&#39;study_type&#39;</span>] != <span class="charliteral">&#39;1&#39;</span>) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      $column_options[<span class="stringliteral">&#39;11&#39;</span>] = <span class="stringliteral">&#39;Source Plant Identifier&#39;</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>] = array(</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;fieldset&#39;</span>,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="stringliteral">&#39;#collapsible&#39;</span> =&gt; TRUE,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="stringliteral">&#39;#states&#39;</span> =&gt; ($i &gt; 1) ? array(</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="stringliteral">&#39;visible&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          <span class="stringliteral">&#39;:input[name=&quot;tree-accession[check]&quot;]&#39;</span> =&gt; array(<span class="stringliteral">&#39;checked&#39;</span> =&gt; TRUE),</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        ),</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      ) : NULL,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    );</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>] = array(</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;managed_file&#39;</span>,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="stringliteral">&#39;#title&#39;</span> =&gt; $title,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="stringliteral">&#39;#upload_location&#39;</span> =&gt; $file_upload_location,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="stringliteral">&#39;#upload_validators&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="stringliteral">&#39;file_validate_extensions&#39;</span> =&gt; array(<span class="stringliteral">&#39;txt csv xlsx&#39;</span>),</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      ),</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="stringliteral">&#39;#field_prefix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;span style=&quot;width: 100%;display: block;text-align: right;padding-right: 2%;&quot;&gt;Allowed file extensions: txt csv xlsx&lt;/span&gt;&#39;</span>,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="stringliteral">&#39;#suffix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;style&gt;figure {}&lt;/style&gt;&#39;</span>,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="stringliteral">&#39;empty&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; isset($values[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;empty&#39;</span>]) ? $values[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;empty&#39;</span>] : <span class="stringliteral">&#39;NA&#39;</span>,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      ),</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="stringliteral">&#39;columns&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="stringliteral">&#39;#description&#39;</span> =&gt; <span class="stringliteral">&#39;Please define which columns hold the required data: Plant Identifier and Location. If your plants are located based on a population group, you can provide the population group column and a mapping of population group to location below.&#39;</span>,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      ),</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="stringliteral">&#39;no-header&#39;</span> =&gt; array(),</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="stringliteral">&#39;empty&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; isset($values[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;empty&#39;</span>]) ? $values[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;empty&#39;</span>] : <span class="stringliteral">&#39;NA&#39;</span>,</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      ),</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="stringliteral">&#39;columns-options&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;hidden&#39;</span>,</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="stringliteral">&#39;#value&#39;</span> =&gt; $column_options,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      ),</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    );</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;coord-format&#39;</span>] = array(</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;select&#39;</span>,</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;Coordinate Projection&#39;</span>),</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="stringliteral">&#39;#options&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="stringliteral">&#39;WGS 84&#39;</span>,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="stringliteral">&#39;NAD 83&#39;</span>,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="stringliteral">&#39;ETRS 89&#39;</span>,</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="stringliteral">&#39;Other Coordinate Projection&#39;</span>,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="stringliteral">&#39;My file does not use coordinates for plant locations&#39;</span>,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      ),</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="stringliteral">&#39;#states&#39;</span> =&gt; $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;#states&#39;</span>] ?? NULL,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="stringliteral">&#39;#prefix&#39;</span> =&gt; <span class="stringliteral">&quot;&lt;div id=\&quot;population-mapping-species-$i\&quot;&gt;&quot;</span>,</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    );</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    $cols = <a class="code" href="form__utils_8inc.html#a5a7ccf132e84718748575e17ce306024">tpps_get_ajax_value</a>($form_state, array(</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="stringliteral">&#39;tree-accession&#39;</span>,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="stringliteral">&quot;species-$i&quot;</span>,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="stringliteral">&#39;file&#39;</span>,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="stringliteral">&#39;columns&#39;</span>,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    ), NULL, <span class="stringliteral">&#39;file&#39;</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    $fid = <a class="code" href="form__utils_8inc.html#a5a7ccf132e84718748575e17ce306024">tpps_get_ajax_value</a>($form_state, array(</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="stringliteral">&#39;tree-accession&#39;</span>,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="stringliteral">&quot;species-$i&quot;</span>,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="stringliteral">&#39;file&#39;</span>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    ), NULL);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (!empty($fid)) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      $wrapper_id = <span class="stringliteral">&quot;{$fid}_map_wrapper&quot;</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      $button_id = <span class="stringliteral">&quot;{$fid}_map_button&quot;</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;coord-format&#39;</span>][<span class="stringliteral">&#39;#suffix&#39;</span>] = <span class="stringliteral">&quot;&lt;div id=\&quot;$wrapper_id\&quot;&gt;&lt;/div&gt;&quot;</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      . <span class="stringliteral">&quot;&lt;input id=\&quot;$button_id\&quot; type=\&quot;button\&quot; value=\&quot;Click here to view plants on map!\&quot; class=\&quot;btn btn-primary map-button\&quot;&gt;&lt;/input&gt;&quot;</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      $no_header = <a class="code" href="form__utils_8inc.html#a5a7ccf132e84718748575e17ce306024">tpps_get_ajax_value</a>($form_state, array(</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="stringliteral">&#39;tree-accession&#39;</span>,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="stringliteral">&quot;species-$i&quot;</span>,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="stringliteral">&#39;file&#39;</span>,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="stringliteral">&#39;no_header&#39;</span>,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      ), NULL, <span class="stringliteral">&#39;file&#39;</span>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      $id_col = $lat_col = $long_col = NULL;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">foreach</span> ($cols as $key =&gt; $col) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">if</span> ($key[0] != <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          <span class="keywordflow">if</span> ((is_array($col) and $col[<span class="stringliteral">&#39;#value&#39;</span>] == <span class="charliteral">&#39;1&#39;</span>) or (!is_array($col) and $col == <span class="charliteral">&#39;1&#39;</span>)) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            $id_col = $key;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          <span class="keywordflow">if</span> ((is_array($col) and $col[<span class="stringliteral">&#39;#value&#39;</span>] == <span class="charliteral">&#39;4&#39;</span>) or (!is_array($col) and $col == <span class="charliteral">&#39;4&#39;</span>)) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            $lat_col = $key;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <span class="keywordflow">if</span> ((is_array($col) and $col[<span class="stringliteral">&#39;#value&#39;</span>] == <span class="charliteral">&#39;5&#39;</span>) or (!is_array($col) and $col == <span class="charliteral">&#39;5&#39;</span>)) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            $long_col = $key;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      drupal_add_js(array(</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="stringliteral">&#39;tpps&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          <span class="stringliteral">&#39;accession_files&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            $fid =&gt; array(</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;              <span class="stringliteral">&#39;no_header&#39;</span> =&gt; $no_header,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;              <span class="stringliteral">&#39;id_col&#39;</span> =&gt; $id_col,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;              <span class="stringliteral">&#39;lat_col&#39;</span> =&gt; $lat_col,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;              <span class="stringliteral">&#39;long_col&#39;</span> =&gt; $long_col,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;              <span class="stringliteral">&#39;fid&#39;</span> =&gt; $fid,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            ),</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          ),</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        ),</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      ), <span class="stringliteral">&#39;setting&#39;</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      drupal_add_js(array(</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="stringliteral">&#39;tpps&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;          <span class="stringliteral">&#39;map_buttons&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            $fid =&gt; array(</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;              <span class="stringliteral">&#39;wrapper&#39;</span> =&gt; $wrapper_id,</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;              <span class="stringliteral">&#39;button&#39;</span> =&gt; $button_id,</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;              <span class="stringliteral">&#39;fid&#39;</span> =&gt; $fid,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            ),</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          ),</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        )</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      ), <span class="stringliteral">&#39;setting&#39;</span>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;pop-group&#39;</span>] = array(</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;hidden&#39;</span>,</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="stringliteral">&#39;#title&#39;</span> =&gt; <span class="stringliteral">&#39;Population group mapping&#39;</span>,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="stringliteral">&#39;#suffix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="stringliteral">&#39;#tree&#39;</span> =&gt; TRUE,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    );</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    $pop_group_show = FALSE;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    $found_lat = FALSE;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    $found_lng = FALSE;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (!empty($cols)) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">foreach</span> ($cols as $col_name =&gt; $data) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> ($col_name[0] == <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        $val = $data;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        $fid = $form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>] ?? NULL;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> (!empty($data[<span class="stringliteral">&#39;#value&#39;</span>])) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          $fid = $form_state[<span class="stringliteral">&#39;complete form&#39;</span>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;fid&#39;</span>];</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          $val = $data[<span class="stringliteral">&#39;#value&#39;</span>];</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">switch</span> ($val) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            $found_lat = TRUE;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>:</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            $found_lng = TRUE;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;          <span class="keywordflow">case</span> <span class="stringliteral">&#39;12&#39;</span>:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            $pop_group_show = TRUE;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            $pop_col = $col_name;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordflow">if</span> ($pop_group_show and !empty($fid) and ($file = file_load($fid))) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;pop-group&#39;</span>][<span class="stringliteral">&#39;#type&#39;</span>] = <span class="stringliteral">&#39;fieldset&#39;</span>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        $pop_groups = array();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        $options = array(</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          <span class="stringliteral">&#39;columns&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            $pop_col,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          ),</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          <span class="stringliteral">&#39;pop_groups&#39;</span> =&gt; &amp;$pop_groups,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        );</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a>($fid, <span class="stringliteral">&#39;tpps_accession_pop_groups&#39;</span>, $options);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">foreach</span> ($pop_groups as $pop_group) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;pop-group&#39;</span>][$pop_group] = array(</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="stringliteral">&#39;#title&#39;</span> =&gt; <span class="stringliteral">&quot;Location for $name plants from group $pop_group:&quot;</span>,</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          );</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">if</span> ($found_lat and $found_lng) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        unset($form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;pop-group&#39;</span>][<span class="stringliteral">&#39;#suffix&#39;</span>]);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;exact_coords&#39;</span>] = array(</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;checkbox&#39;</span>,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;The provided GPS coordinates are exact&#39;</span>),</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; $form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;exact_coords&#39;</span>] ?? TRUE,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        );</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;coord_precision&#39;</span>] = array(</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          <span class="stringliteral">&#39;#title&#39;</span> =&gt; t(<span class="stringliteral">&#39;Coordinates accuracy:&#39;</span>),</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <span class="stringliteral">&#39;#description&#39;</span> =&gt; t(<span class="stringliteral">&#39;The precision of the provided coordinates. For example, if a plant could be up to 10m awa from the provided coordinates, then the accuracy would be &quot;10m&quot;.&#39;</span>),</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          <span class="stringliteral">&#39;#suffix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          <span class="stringliteral">&#39;#states&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="stringliteral">&#39;visible&#39;</span> =&gt; array(</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;              <span class="stringliteral">&quot;:input[name=\&quot;tree-accession[species-$i][exact_coords]\&quot;]&quot;</span> =&gt; array(<span class="stringliteral">&#39;checked&#39;</span> =&gt; FALSE),</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            ),</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          ),</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        );</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  $map_api_key = variable_get(<span class="stringliteral">&#39;tpps_maps_api_key&#39;</span>, NULL);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span> (!empty($map_api_key)) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&#39;#suffix&#39;</span>] .= <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">    &lt;script src=&quot;https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js&quot;&gt;&lt;/script&gt;</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">    &lt;script src=&quot;https://maps.googleapis.com/maps/api/js?key=&#39;</span> . $map_api_key . <span class="stringliteral">&#39;&amp;callback=initMap&quot;</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">    async defer&gt;&lt;/script&gt;</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral">    &lt;style&gt;</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">      #map_wrapper {</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">      height: 450px;</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">      }</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">    &lt;/style&gt;&#39;</span>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  $form[<span class="stringliteral">&#39;Back&#39;</span>] = array(</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;submit&#39;</span>,</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="stringliteral">&#39;#value&#39;</span> =&gt; t(<span class="stringliteral">&#39;Back&#39;</span>),</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="stringliteral">&#39;#prefix&#39;</span> =&gt; <span class="stringliteral">&#39;&lt;div class=&quot;input-description&quot;&gt;* : Required Field&lt;/div&gt;&#39;</span>,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  );</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  $form[<span class="stringliteral">&#39;Save&#39;</span>] = array(</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;submit&#39;</span>,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="stringliteral">&#39;#value&#39;</span> =&gt; t(<span class="stringliteral">&#39;Save&#39;</span>),</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  );</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  $form[<span class="stringliteral">&#39;Next&#39;</span>] = array(</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;submit&#39;</span>,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="stringliteral">&#39;#value&#39;</span> =&gt; t(<span class="stringliteral">&#39;Next&#39;</span>),</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  );</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="atpps_8module_html_abbdd730f35d5b6b69523d04594326f13"><div class="ttname"><a href="tpps_8module.html#abbdd730f35d5b6b69523d04594326f13">TPPS_PAGE_2</a></div><div class="ttdeci">const TPPS_PAGE_2</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00013">tpps.module:13</a></div></div>
<div class="ttc" id="aform__utils_8inc_html_a5a7ccf132e84718748575e17ce306024"><div class="ttname"><a href="form__utils_8inc.html#a5a7ccf132e84718748575e17ce306024">tpps_get_ajax_value</a></div><div class="ttdeci">tpps_get_ajax_value(array &amp;$state, array $parents, $default=NULL, $file_name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="form__utils_8inc_source.html#l00236">form_utils.inc:236</a></div></div>
<div class="ttc" id="atpps_8module_html_aee3f84bc39f996a79a7937348f3fd014"><div class="ttname"><a href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a></div><div class="ttdeci">const TPPS_PAGE_3</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00014">tpps.module:14</a></div></div>
<div class="ttc" id="atpps_8module_html_ab6d360adf17e04ae1e28c082a3f84cc4"><div class="ttname"><a href="tpps_8module.html#ab6d360adf17e04ae1e28c082a3f84cc4">tpps_access</a></div><div class="ttdeci">tpps_access($permission, array $args=array())</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00246">tpps.module:246</a></div></div>
<div class="ttc" id="abuild_2page__3_8php_html_af344aedb3f06c89a02a5d26f932169b3"><div class="ttname"><a href="build_2page__3_8php.html#af344aedb3f06c89a02a5d26f932169b3">tpps_page_3_create_form</a></div><div class="ttdeci">tpps_page_3_create_form(array &amp;$form, array &amp;$form_state)</div><div class="ttdef"><b>Definition:</b> <a href="build_2page__3_8php_source.html#l00024">page_3.php:24</a></div></div>
<div class="ttc" id="apage__3__helper_8php_html_ac941b31acff40a333b85240d6c9980c5"><div class="ttname"><a href="page__3__helper_8php.html#ac941b31acff40a333b85240d6c9980c5">tpps_study_location</a></div><div class="ttdeci">tpps_study_location(array &amp;$form, array &amp;$form_state)</div><div class="ttdef"><b>Definition:</b> <a href="page__3__helper_8php_source.html#l00019">page_3_helper.php:19</a></div></div>
<div class="ttc" id="afile__utils_8inc_html_a2dbdebe050f31627585ffe69727c8fff"><div class="ttname"><a href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a></div><div class="ttdeci">tpps_file_iterator($fid, $function, array &amp;$options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00860">file_utils.inc:860</a></div></div>
<div class="ttc" id="atpps_8module_html_afc7626d0d50cc6f3389e67ff010c6d23"><div class="ttname"><a href="tpps_8module.html#afc7626d0d50cc6f3389e67ff010c6d23">TPPS_PAGE_1</a></div><div class="ttdeci">const TPPS_PAGE_1</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00012">tpps.module:12</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_9dbe3317d04b259e5582aecba81cb3e5.html">forms</a></li><li class="navelem"><a class="el" href="dir_e0d1b946d5f1736b3bdec0b7ff95e836.html">build</a></li><li class="navelem"><a class="el" href="build_2page__3_8php.html">page_3.php</a></li>
    <li class="footer">Generated on Tue Dec 8 2020 14:19:07 for Tripal Plant PopGen Submit by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
