<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Tripal Plant PopGen Submit: /var/www/html/sites/all/modules/TGDR/includes/file_utils.inc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tripal Plant PopGen Submit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('file__utils_8inc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">file_utils.inc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="file__utils_8inc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a02cb2be506d23ec7eb9324ef5b0a6ff4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a02cb2be506d23ec7eb9324ef5b0a6ff4">tpps_compare_files</a> ($fid_1, $fid_2, $file_1_id_name, $file_2_id_name, $file_1_no_header=FALSE, $file_2_no_header=FALSE)</td></tr>
<tr class="separator:a02cb2be506d23ec7eb9324ef5b0a6ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e2694749fd7ce91841aeb6b08c9f0fc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a0e2694749fd7ce91841aeb6b08c9f0fc">tpps_convert_colname</a> ($column)</td></tr>
<tr class="separator:a0e2694749fd7ce91841aeb6b08c9f0fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0762a5fee8c8091f4e8f12dfc0c04409"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a0762a5fee8c8091f4e8f12dfc0c04409">tpps_file_generator</a> ($fid, array $options=array())</td></tr>
<tr class="separator:a0762a5fee8c8091f4e8f12dfc0c04409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3aaa23338a57219a37369743bcdd1ab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#ab3aaa23338a57219a37369743bcdd1ab">tpps_file_headers</a> ($fid, $no_header=FALSE)</td></tr>
<tr class="separator:ab3aaa23338a57219a37369743bcdd1ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dbdebe050f31627585ffe69727c8fff"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a> ($fid, $function, array &amp;$options=array())</td></tr>
<tr class="separator:a2dbdebe050f31627585ffe69727c8fff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ea01f157958a5f304919c60cf04e84d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a4ea01f157958a5f304919c60cf04e84d">tpps_file_len</a> ($fid)</td></tr>
<tr class="separator:a4ea01f157958a5f304919c60cf04e84d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0efda8838b7f768f55e3acd2ab56dfb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#ad0efda8838b7f768f55e3acd2ab56dfb">tpps_file_len_helper</a> ($row, array &amp;$options=array())</td></tr>
<tr class="separator:ad0efda8838b7f768f55e3acd2ab56dfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acedf90c1091e02904f2bd886b83640fe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#acedf90c1091e02904f2bd886b83640fe">tpps_file_validate_columns</a> (array &amp;$form_state, array $required_groups, array $file_element)</td></tr>
<tr class="separator:acedf90c1091e02904f2bd886b83640fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86f3c1f203f47ecd5baa381a14fd22b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a86f3c1f203f47ecd5baa381a14fd22b2">tpps_file_width</a> ($fid)</td></tr>
<tr class="separator:a86f3c1f203f47ecd5baa381a14fd22b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7afce8766c446d0edd0ef301c027e482"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a7afce8766c446d0edd0ef301c027e482">tpps_flat_generator</a> ($location, array $options=array())</td></tr>
<tr class="separator:a7afce8766c446d0edd0ef301c027e482"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcda1034b641c9233a479037081f0157"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#adcda1034b641c9233a479037081f0157">tpps_flat_width</a> ($location, $delim= ',')</td></tr>
<tr class="separator:adcda1034b641c9233a479037081f0157"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3400c252f893838d83ffe4b56bd23d44"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a3400c252f893838d83ffe4b56bd23d44">tpps_get_archive_files</a> ($archive)</td></tr>
<tr class="separator:a3400c252f893838d83ffe4b56bd23d44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdf6d662ed7a3c794957ac802f740236"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a> ($location)</td></tr>
<tr class="separator:acdf6d662ed7a3c794957ac802f740236"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab568bce2ab8f3f321b3379fab168421"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a> ($path)</td></tr>
<tr class="separator:aab568bce2ab8f3f321b3379fab168421"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04798048750e2b7829434f790df3c040"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a> ($hex)</td></tr>
<tr class="separator:a04798048750e2b7829434f790df3c040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42b4df00b61325b2402990d6b361da92"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a42b4df00b61325b2402990d6b361da92">tpps_parse_file</a> ($fid, $max_rows=0, $no_header=FALSE, $columns=NULL)</td></tr>
<tr class="separator:a42b4df00b61325b2402990d6b361da92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6176e642def9ba548e7b0a8c1fb01026"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a6176e642def9ba548e7b0a8c1fb01026">tpps_parse_file_column</a> ($fid, $column, $no_header=FALSE)</td></tr>
<tr class="separator:a6176e642def9ba548e7b0a8c1fb01026"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a61b7b422f74d54c5e14b3f00a34ec6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a7a61b7b422f74d54c5e14b3f00a34ec6">tpps_parse_file_column_helper</a> ($row, &amp;$options)</td></tr>
<tr class="separator:a7a61b7b422f74d54c5e14b3f00a34ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3162a76ee851e1f8691b98d1dcf4e3f0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a3162a76ee851e1f8691b98d1dcf4e3f0">tpps_parse_file_helper</a> ($row, &amp;$options)</td></tr>
<tr class="separator:a3162a76ee851e1f8691b98d1dcf4e3f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad36de4423e30ab4fa6985458240d7e68"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#ad36de4423e30ab4fa6985458240d7e68">tpps_rename_file</a> ($fid, $new_name, array $options=array())</td></tr>
<tr class="separator:ad36de4423e30ab4fa6985458240d7e68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3b2a0284d8f175fa87b03595b2c6ee5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a> ($dir)</td></tr>
<tr class="separator:ac3b2a0284d8f175fa87b03595b2c6ee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae817c2bfb237f057a9b36a5d2ff3d3ae"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#ae817c2bfb237f057a9b36a5d2ff3d3ae">tpps_save_file_columns</a> (array &amp;$form, array &amp;$form_state)</td></tr>
<tr class="separator:ae817c2bfb237f057a9b36a5d2ff3d3ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d5cd2d23ff3c3c58cd7c926dbed0cb6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a6d5cd2d23ff3c3c58cd7c926dbed0cb6">tpps_xlsx_generator</a> ($location, array $options=array())</td></tr>
<tr class="separator:a6d5cd2d23ff3c3c58cd7c926dbed0cb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b81987f3b85a902ea5542b66345398c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a7b81987f3b85a902ea5542b66345398c">tpps_xlsx_get_cell_value</a> (&amp;$reader, $cell_type, array &amp;$strings=array())</td></tr>
<tr class="separator:a7b81987f3b85a902ea5542b66345398c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe0df5b92f8425efc2d3cd9940bc1e51"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#afe0df5b92f8425efc2d3cd9940bc1e51">tpps_xlsx_get_dimension</a> ($location)</td></tr>
<tr class="separator:afe0df5b92f8425efc2d3cd9940bc1e51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac918f4fcada1230489f270904c4c0e63"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#ac918f4fcada1230489f270904c4c0e63">tpps_xlsx_get_row</a> (&amp;$reader, &amp;$strings=array(), $plain=TRUE, $columns=NULL)</td></tr>
<tr class="separator:ac918f4fcada1230489f270904c4c0e63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25959c1e5bdea2a2091d588f73921aba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a25959c1e5bdea2a2091d588f73921aba">tpps_xlsx_get_rows</a> (&amp;$readers, &amp;$strings=array(), $plain=TRUE, $columns=NULL)</td></tr>
<tr class="separator:a25959c1e5bdea2a2091d588f73921aba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb48dfcbe1da9e76d38c6eee361bc230"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#aeb48dfcbe1da9e76d38c6eee361bc230">tpps_xlsx_get_strings</a> ($strings_location)</td></tr>
<tr class="separator:aeb48dfcbe1da9e76d38c6eee361bc230"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65da39eb37cedbb6c9fce5c088bbf665"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a65da39eb37cedbb6c9fce5c088bbf665">tpps_xlsx_translate_date</a> ($date)</td></tr>
<tr class="separator:a65da39eb37cedbb6c9fce5c088bbf665"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a381868684e1030cc0c461c25a5789b7d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__utils_8inc.html#a381868684e1030cc0c461c25a5789b7d">tpps_xlsx_width</a> ($location)</td></tr>
<tr class="separator:a381868684e1030cc0c461c25a5789b7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines useful functions for file management. </p>

<p>Definition in file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a02cb2be506d23ec7eb9324ef5b0a6ff4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_compare_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid_2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$file_1_id_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$file_2_id_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$file_1_no_header</em> = <code>FALSE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$file_2_no_header</em> = <code>FALSE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compares two file columns.</p>
<p>Returns the array of items that are found in file 1, column file_1_id_name, and are not found in file 2, column file_2_id_name.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid_1</td><td>File 1 identifier. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$fid_2</td><td>File 2 identifier. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$file_1_id_name</td><td>Name of column to check in file 1. String or integer. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$file_2_id_name</td><td>Name of column to check in file 2. String or integer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array The array of items found in file 1 that were not found in file 2. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00359">359</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                                                                                                                    {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  $missing = array();</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  $file_1_content = array_unique(<a class="code" href="file__utils_8inc.html#a6176e642def9ba548e7b0a8c1fb01026">tpps_parse_file_column</a>($fid_1, $file_1_id_name, $file_1_no_header));</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  $file_2_content = array_unique(<a class="code" href="file__utils_8inc.html#a6176e642def9ba548e7b0a8c1fb01026">tpps_parse_file_column</a>($fid_2, $file_2_id_name, $file_2_no_header));</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  asort($file_1_content);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  asort($file_2_content);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  reset($file_1_content);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  reset($file_2_content);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">while</span> (current($file_1_content) !== FALSE and current($file_2_content) !== FALSE) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (current($file_1_content) &lt; current($file_2_content)) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      $missing[] = current($file_1_content);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      next($file_1_content);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    elseif (current($file_1_content) &gt; current($file_2_content)) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      next($file_2_content);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    next($file_1_content);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    next($file_2_content);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">while</span> (current($file_1_content) !== FALSE) {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    $missing[] = current($file_1_content);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    next($file_1_content);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">return</span> $missing;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a6176e642def9ba548e7b0a8c1fb01026"><div class="ttname"><a href="file__utils_8inc.html#a6176e642def9ba548e7b0a8c1fb01026">tpps_parse_file_column</a></div><div class="ttdeci">tpps_parse_file_column($fid, $column, $no_header=FALSE)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00314">file_utils.inc:314</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0e2694749fd7ce91841aeb6b08c9f0fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_convert_colname </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$column</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function will convert a hexadecimal column id to an integer.</p>
<p>Here are a few examples of column keys and their converted integers: echo tpps_convert_colname('A'); // 0 echo tpps_convert_colname('B'); // 1 echo tpps_convert_colname('AA'); // 26 echo tpps_convert_colname('AB'); // 27 echo tpps_convert_colname('BA'); // 52</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$column</td><td>The capital alphabetical key for the column.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int The integer conversion of the column key. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00251">251</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                       {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  $total = 0;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  $base_16 = unpack(<span class="stringliteral">&#39;H*&#39;</span>, <span class="charliteral">&#39;A&#39;</span>)[1];</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  $base = base_convert($base_16, 16, 10) - 1;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">for</span> ($i = 0; $i &lt; strlen($column); $i++) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    $total *= 26;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    $num_16 = unpack(<span class="stringliteral">&#39;H*&#39;</span>, $column[$i])[1];</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    $total += base_convert($num_16, 16, 10) - $base;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">return</span> $total - 1;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0762a5fee8c8091f4e8f12dfc0c04409"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_generator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function selects the appropriate generator for a file.</p>
<p>The generator is selected based on the file extension. If the extension is not recognized, throws an exception.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file id for the file. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options to be passed to the generator.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Generator|array The generator for the file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l01022">1022</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                                             {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  $file = file_load($fid);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  $location = <a class="code" href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a>($file-&gt;uri);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  $extension = <a class="code" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a>($location);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordflow">switch</span> ($extension) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;xlsx&#39;</span>:</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="file__utils_8inc.html#a6d5cd2d23ff3c3c58cd7c926dbed0cb6">tpps_xlsx_generator</a>($location, $options);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;txt&#39;</span>:</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;csv&#39;</span>:</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;vcf&#39;</span>:</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="file__utils_8inc.html#a7afce8766c446d0edd0ef301c027e482">tpps_flat_generator</a>($location, $options);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keywordflow">if</span> (empty($extension)) {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        $extension = <span class="stringliteral">&quot;NULL&quot;</span>;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      $msg = <span class="stringliteral">&quot;Unrecognized file type: $extension&quot;</span>;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($msg);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a7afce8766c446d0edd0ef301c027e482"><div class="ttname"><a href="file__utils_8inc.html#a7afce8766c446d0edd0ef301c027e482">tpps_flat_generator</a></div><div class="ttdeci">tpps_flat_generator($location, array $options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l01168">file_utils.inc:1168</a></div></div>
<div class="ttc" id="file__utils_8inc_html_aab568bce2ab8f3f321b3379fab168421"><div class="ttname"><a href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a></div><div class="ttdeci">tpps_get_path_extension($path)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00645">file_utils.inc:645</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a6d5cd2d23ff3c3c58cd7c926dbed0cb6"><div class="ttname"><a href="file__utils_8inc.html#a6d5cd2d23ff3c3c58cd7c926dbed0cb6">tpps_xlsx_generator</a></div><div class="ttdeci">tpps_xlsx_generator($location, array $options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l01059">file_utils.inc:1059</a></div></div>
<div class="ttc" id="file__utils_8inc_html_acdf6d662ed7a3c794957ac802f740236"><div class="ttname"><a href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a></div><div class="ttdeci">tpps_get_location($location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00624">file_utils.inc:624</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab3aaa23338a57219a37369743bcdd1ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_headers </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$no_header</em> = <code>FALSE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the headers of a TPPS file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file id of the file. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$no_header</td><td>Whether or not the no_header option has been set for the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array An array of headers for the file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00950">950</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                                     {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  $headers = array();</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> ($no_header) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    $hex = unpack(<span class="stringliteral">&#39;H*&#39;</span>, <span class="charliteral">&#39;A&#39;</span>)[1];</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    $width = <a class="code" href="file__utils_8inc.html#a86f3c1f203f47ecd5baa381a14fd22b2">tpps_file_width</a>($fid);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">for</span> ($i = 0; $i &lt; $width; $i++) {</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      $key = pack(<span class="stringliteral">&#39;H*&#39;</span>, $hex);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      $headers[$key] = $i;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      $hex = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($hex);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">return</span> $headers;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  $content = array();</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  $options = array(</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="stringliteral">&#39;no_header&#39;</span> =&gt; TRUE,</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="stringliteral">&#39;max_rows&#39;</span> =&gt; 1,</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="stringliteral">&#39;content&#39;</span> =&gt; &amp;$content,</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  );</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <a class="code" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a>($fid, <span class="stringliteral">&#39;tpps_parse_file_helper&#39;</span>, $options);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">return</span> current($content);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a86f3c1f203f47ecd5baa381a14fd22b2"><div class="ttname"><a href="file__utils_8inc.html#a86f3c1f203f47ecd5baa381a14fd22b2">tpps_file_width</a></div><div class="ttdeci">tpps_file_width($fid)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00114">file_utils.inc:114</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a04798048750e2b7829434f790df3c040"><div class="ttname"><a href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a></div><div class="ttdeci">tpps_increment_hex($hex)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00216">file_utils.inc:216</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a2dbdebe050f31627585ffe69727c8fff"><div class="ttname"><a href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a></div><div class="ttdeci">tpps_file_iterator($fid, $function, array &amp;$options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00989">file_utils.inc:989</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2dbdebe050f31627585ffe69727c8fff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_iterator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Iterates over a file and applies a function to each generator result.</p>
<p>This function should be used in place of <a class="el" href="file__utils_8inc.html#a42b4df00b61325b2402990d6b361da92">tpps_parse_file()</a> wherever possible, as it uses much less memory and is much faster.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file id of the file. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$function</td><td>The funciton to be applied to each item returned by the generator. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Options that will be passed to both $function and the generator.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool Returns TRUE on success, otherwise FALSE. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00989">989</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                                                                        {</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordflow">if</span> (!function_exists($function)) {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">return</span> FALSE;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;job&#39;</span>])) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    $options[<span class="stringliteral">&#39;job&#39;</span>]-&gt;setTotalItems(<a class="code" href="file__utils_8inc.html#a4ea01f157958a5f304919c60cf04e84d">tpps_file_len</a>($fid));</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    $options[<span class="stringliteral">&#39;job&#39;</span>]-&gt;setItemsHandled(0);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  }</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">foreach</span> (<a class="code" href="file__utils_8inc.html#a0762a5fee8c8091f4e8f12dfc0c04409">tpps_file_generator</a>($fid, $options) as $item) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    $function($item, $options);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;job&#39;</span>])) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      $options[<span class="stringliteral">&#39;job&#39;</span>]-&gt;addItemsHandled(1);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keywordflow">return</span> TRUE;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a4ea01f157958a5f304919c60cf04e84d"><div class="ttname"><a href="file__utils_8inc.html#a4ea01f157958a5f304919c60cf04e84d">tpps_file_len</a></div><div class="ttdeci">tpps_file_len($fid)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00064">file_utils.inc:64</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a0762a5fee8c8091f4e8f12dfc0c04409"><div class="ttname"><a href="file__utils_8inc.html#a0762a5fee8c8091f4e8f12dfc0c04409">tpps_file_generator</a></div><div class="ttdeci">tpps_file_generator($fid, array $options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l01022">file_utils.inc:1022</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ea01f157958a5f304919c60cf04e84d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_len </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the number of lines or rows in a file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file identifier of the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int The number of lines or rows in the file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00064">64</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                             {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  $file = file_load($fid);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  $location = <a class="code" href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a>($file-&gt;uri);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  $extension = <a class="code" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a>($location);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  $count = 0;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  $options = array(</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="stringliteral">&#39;count&#39;</span> =&gt; &amp;$count,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  );</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> ($extension == <span class="stringliteral">&#39;vcf&#39;</span>) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    $options[<span class="stringliteral">&#39;skip_prefix&#39;</span>] = <span class="charliteral">&#39;#&#39;</span>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a>($fid, <span class="stringliteral">&#39;tpps_file_len_helper&#39;</span>, $options);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">return</span> $count;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_aab568bce2ab8f3f321b3379fab168421"><div class="ttname"><a href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a></div><div class="ttdeci">tpps_get_path_extension($path)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00645">file_utils.inc:645</a></div></div>
<div class="ttc" id="file__utils_8inc_html_acdf6d662ed7a3c794957ac802f740236"><div class="ttname"><a href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a></div><div class="ttdeci">tpps_get_location($location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00624">file_utils.inc:624</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a2dbdebe050f31627585ffe69727c8fff"><div class="ttname"><a href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a></div><div class="ttdeci">tpps_file_iterator($fid, $function, array &amp;$options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00989">file_utils.inc:989</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad0efda8838b7f768f55e3acd2ab56dfb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_len_helper </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$row</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the helper function for <a class="el" href="file__utils_8inc.html#a4ea01f157958a5f304919c60cf04e84d">tpps_file_len()</a>.</p>
<p>This function is passed to the tpps_file_iterator during tpps_file_len, and increments the count attribute of the options array. It also checks whether a skip_prefix was provided, and skips lines if necessary.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$row</td><td>The item yielded by the TPPS file generator. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options set when calling <a class="el" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator()</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00091">91</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                                               {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;skip_prefix&#39;</span>])) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    $options[<span class="stringliteral">&#39;count&#39;</span>]++;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (substr(current($row), 0, strlen($options[<span class="stringliteral">&#39;skip_prefix&#39;</span>])) != $options[<span class="stringliteral">&#39;skip_prefix&#39;</span>]) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      $options[<span class="stringliteral">&#39;count&#39;</span>]++;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acedf90c1091e02904f2bd886b83640fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_validate_columns </td>
          <td>(</td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$form_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$required_groups</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$file_element</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function validates that the file contains all of the required groups.</p>
<p>A "required group" is a column type that must be present within the file for the file to be considered valid. For instance, a required group for a plant accession file would be the "Location" group. The required groups array should satisfy the structure: array( '&lt;group name&gt;=""&gt;' =&gt; array( '&lt;type&gt;' =&gt; array(&lt;column option="" index&gt;=""&gt;[, &lt;column option="" index&gt;=""&gt;...])[, '&lt;type&gt;' =&gt; array(&lt;column option="" index&gt;=""&gt;[, &lt;column option="" index&gt;=""&gt;...])...] )[, '&lt;group name&gt;=""&gt;' =&gt; array( '&lt;type&gt;' =&gt; array(&lt;column option="" index&gt;=""&gt;[, &lt;column option="" index&gt;=""&gt;...])[, '&lt;type&gt;' =&gt; array(&lt;column option="" index&gt;=""&gt;[, &lt;column option="" index&gt;=""&gt;...])...] )...] ) where &lt;group name&gt;=""&gt; is the name of the required group, &lt;type&gt; is the name of the set of options that could satisfy the required group, and each of the &lt;column option="" index&gt;=""&gt;s is a key within the file element['column-options'] field.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$form_state</td><td>The state of the form that the file is part of. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$required_groups</td><td>The required column option groups for the file. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$file_element</td><td>The managed_file element of the file within the form.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array The groups and the column option types that the file was valid for. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00422">422</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                                                                                     {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  $cols = $file_element[<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>];</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  $parents = $file_element[<span class="stringliteral">&#39;#parents&#39;</span>];</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  $new_end_columns = end($parents) . <span class="stringliteral">&quot;-columns&quot;</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  $new_end_no_header = end($parents) . <span class="stringliteral">&quot;-no-header&quot;</span>;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  $new_end_empty = end($parents) . <span class="stringliteral">&quot;-empty&quot;</span>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  $group_path = array_pop($parents) . <span class="stringliteral">&quot;-groups&quot;</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  $values = &amp;$form_state[<span class="stringliteral">&#39;values&#39;</span>];</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">foreach</span> ($parents as $item) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    $values = &amp;$values[$item];</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// Initialize form column values in form state.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  $values[$new_end_columns] = array();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="comment">// Hold onto the location of the columns in form state.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  $state_column_values = &amp;$values[$new_end_columns];</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  $values[$new_end_no_header] = isset($file_element[<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;no-header&#39;</span>]) ? $file_element[<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;no-header&#39;</span>] : NULL;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  $values[$new_end_empty] = isset($file_element[<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;empty&#39;</span>]) ? $file_element[<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;empty&#39;</span>] : NULL;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  $title_parts = explode(<span class="charliteral">&#39;:&#39;</span>, $file_element[<span class="stringliteral">&#39;#title&#39;</span>]);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  $error_prompt = $title_parts[0];</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  $groups = array();</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  $required_groups_flat = array();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">foreach</span> ($required_groups as $group =&gt; $combinations) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    $groups[$group] = array();</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    $required_groups_flat[$group] = array();</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">foreach</span> ($combinations as $name =&gt; $combination) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      $required_groups_flat[$group] = array_merge($required_groups_flat[$group], $combination);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// dpm($required_groups_flat);</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// dpm($cols);</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// dpm($state_column_values);</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">foreach</span> ($cols as $name =&gt; $type) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    $state_column_values[$name] = $type;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">foreach</span> ($required_groups_flat as $group =&gt; $types) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">if</span> (in_array($type, $types)) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span> (!isset($groups[$group][$type])) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          $groups[$group][$type] = array($name);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;          $groups[$group][$type][] = $name;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="comment">// dpm($groups);</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordflow">foreach</span> ($required_groups as $group =&gt; $combinations) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    $group_valid = FALSE;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    $groups[$group][<span class="stringliteral">&#39;#type&#39;</span>] = array();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">foreach</span> ($combinations as $name =&gt; $combination) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      $combination_valid = TRUE;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keywordflow">foreach</span> ($combination as $type) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span> (!isset($groups[$group][$type])) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;          $combination_valid = FALSE;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">if</span> ($combination_valid) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        $groups[$group][<span class="stringliteral">&#39;#type&#39;</span>][] = $name;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        $group_valid = TRUE;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (!$group_valid) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      form_set_error($file_element[<span class="stringliteral">&#39;#name&#39;</span>] . <span class="stringliteral">&quot;[columns][$group&quot;</span>, <span class="stringliteral">&quot;$error_prompt: Please specify a column or columns that hold $group.&quot;</span>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">foreach</span> ($groups as $key =&gt; $group) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">foreach</span> ($group as $opt_num =&gt; $col_names) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordflow">if</span> (count($col_names) == 1) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        $groups[$key][$opt_num] = $col_names[0];</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  $values[$group_path] = $groups;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">return</span> $groups;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a86f3c1f203f47ecd5baa381a14fd22b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_file_width </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function returns the width of a file.</p>
<p>The process of finding the width of the file is done with the use of helper functions, and this function returns the results.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file identifier of the file to be parsed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int The length of the longest line in the file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00114">114</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                               {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  $file = file_load($fid);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  $location = <a class="code" href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a>($file-&gt;uri);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  $extension = <a class="code" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a>($location);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">switch</span> ($extension) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;xlsx&#39;</span>:</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="file__utils_8inc.html#a381868684e1030cc0c461c25a5789b7d">tpps_xlsx_width</a>($location);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;txt&#39;</span>:</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;csv&#39;</span>:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="file__utils_8inc.html#adcda1034b641c9233a479037081f0157">tpps_flat_width</a>($location);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">case</span> <span class="stringliteral">&#39;vcf&#39;</span>:</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="file__utils_8inc.html#adcda1034b641c9233a479037081f0157">tpps_flat_width</a>($location, <span class="stringliteral">&quot;\t&quot;</span>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Unrecognized file type&#39;</span>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_aab568bce2ab8f3f321b3379fab168421"><div class="ttname"><a href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a></div><div class="ttdeci">tpps_get_path_extension($path)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00645">file_utils.inc:645</a></div></div>
<div class="ttc" id="file__utils_8inc_html_adcda1034b641c9233a479037081f0157"><div class="ttname"><a href="file__utils_8inc.html#adcda1034b641c9233a479037081f0157">tpps_flat_width</a></div><div class="ttdeci">tpps_flat_width($location, $delim= ',')</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00180">file_utils.inc:180</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a381868684e1030cc0c461c25a5789b7d"><div class="ttname"><a href="file__utils_8inc.html#a381868684e1030cc0c461c25a5789b7d">tpps_xlsx_width</a></div><div class="ttdeci">tpps_xlsx_width($location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00146">file_utils.inc:146</a></div></div>
<div class="ttc" id="file__utils_8inc_html_acdf6d662ed7a3c794957ac802f740236"><div class="ttname"><a href="file__utils_8inc.html#acdf6d662ed7a3c794957ac802f740236">tpps_get_location</a></div><div class="ttdeci">tpps_get_location($location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00624">file_utils.inc:624</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7afce8766c446d0edd0ef301c027e482"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_flat_generator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is s generator for flat files.</p>
<p>If the 'max_rows' option is set, the generator stop after max_rows items are yielded. If the 'columns' option is set, then each item yielded by the generator will contain only the specified columns from the row.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$location</td><td>The location of the file on the server. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options detailing how to parse the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Generator|array Yields each row of the file (or columns of a row, if applicable). </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l01168">1168</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                                                                  {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  $original = ini_get(<span class="stringliteral">&#39;auto_detect_line_endings&#39;</span>);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordflow">if</span> (!$original) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    ini_set(<span class="stringliteral">&#39;auto_detect_line_endings&#39;</span>, TRUE);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  $no_header = $options[<span class="stringliteral">&#39;no_header&#39;</span>] ?? FALSE;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  $columns = $options[<span class="stringliteral">&#39;columns&#39;</span>] ?? NULL;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  $max_rows = $options[<span class="stringliteral">&#39;max_rows&#39;</span>] ?? NULL;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  $delim = <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  $longest = <a class="code" href="file__utils_8inc.html#adcda1034b641c9233a479037081f0157">tpps_flat_width</a>($location, $delim);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  $handle = fopen($location, <span class="charliteral">&#39;r&#39;</span>);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">if</span> (!$no_header) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    fgetcsv($handle);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  $count = 0;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordflow">while</span> (($vals = fgetcsv($handle, 0, $delim))) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">if</span> (!empty($max_rows) and $count &gt;= $max_rows) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    }</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    $count++;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    $values = array();</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">if</span> (empty($columns)) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      $hex = unpack(<span class="stringliteral">&#39;H*&#39;</span>, <span class="charliteral">&#39;A&#39;</span>)[1];</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="keywordflow">for</span> ($i = 0; $i &lt; $longest; $i++) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        $key = pack(<span class="stringliteral">&#39;H*&#39;</span>, $hex);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        $values[$key] = isset($vals[$i]) ? trim($vals[$i]) : NULL;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="keywordflow">if</span> (isset($values[$key]) and !check_plain($values[$key])) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;          $values[$key] = trim(mb_convert_encoding($values[$key], <span class="stringliteral">&quot;UTF-8&quot;</span>, <span class="stringliteral">&quot;Windows-1252&quot;</span>));</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        }</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        $hex = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($hex);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      }</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      yield $values;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    }</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">foreach</span> ($columns as $column) {</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      $values[$column] = $vals[<a class="code" href="file__utils_8inc.html#a0e2694749fd7ce91841aeb6b08c9f0fc">tpps_convert_colname</a>($column)] ?? NULL;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    yield $values;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  }</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  fclose($handle);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  ini_set(<span class="stringliteral">&#39;auto_detect_line_endings&#39;</span>, $original);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a04798048750e2b7829434f790df3c040"><div class="ttname"><a href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a></div><div class="ttdeci">tpps_increment_hex($hex)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00216">file_utils.inc:216</a></div></div>
<div class="ttc" id="file__utils_8inc_html_adcda1034b641c9233a479037081f0157"><div class="ttname"><a href="file__utils_8inc.html#adcda1034b641c9233a479037081f0157">tpps_flat_width</a></div><div class="ttdeci">tpps_flat_width($location, $delim= ',')</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00180">file_utils.inc:180</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a0e2694749fd7ce91841aeb6b08c9f0fc"><div class="ttname"><a href="file__utils_8inc.html#a0e2694749fd7ce91841aeb6b08c9f0fc">tpps_convert_colname</a></div><div class="ttdeci">tpps_convert_colname($column)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00251">file_utils.inc:251</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adcda1034b641c9233a479037081f0157"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_flat_width </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$delim</em> = <code>','</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function gets the length of the longest line of a flat file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$location</td><td>The location of the file. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$delim</td><td>The delimeter for each line in the file. Defaults to ','.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int The length of the longest line. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00180">180</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                                  {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  $original = ini_get(<span class="stringliteral">&#39;auto_detect_line_endings&#39;</span>);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">if</span> (!$original) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    ini_set(<span class="stringliteral">&#39;auto_detect_line_endings&#39;</span>, TRUE);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  $longest = 0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  $handle = fopen($location, <span class="charliteral">&#39;r&#39;</span>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">while</span> (($line = fgetcsv($handle, 0, $delim))) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    $longest = max($longest, count($line));</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  fclose($handle);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  ini_set(<span class="stringliteral">&#39;auto_detect_line_endings&#39;</span>, $original);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">return</span> $longest;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3400c252f893838d83ffe4b56bd23d44"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_get_archive_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$archive</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Extracts an archive from a path or Drupal file object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$archive</td><td>The archive to be extracted. Can be a path or Drupal file object.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Array of file names. NULL if extension is not a valid compression extension. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00890">890</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                          {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  $files = array();</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">if</span> (is_object($archive) and !empty($archive-&gt;uri)) {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    $archive = $archive-&gt;uri;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  $loc = drupal_realpath($archive);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  $ext = <a class="code" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a>($loc);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  $unzip_dir = dirname($loc) . <span class="stringliteral">&#39;/tmp&#39;</span>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordflow">if</span> (is_dir($unzip_dir)) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <a class="code" href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a>($unzip_dir);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keywordflow">if</span> (is_dir($unzip_dir) or mkdir($unzip_dir)) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">switch</span> ($ext) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">case</span> <span class="stringliteral">&#39;zip&#39;</span>:</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        $zip = new \ZipArchive();</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        $zip-&gt;open($loc);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      <span class="keywordflow">case</span> <span class="stringliteral">&#39;gz&#39;</span>:</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        $zip = new \PharData($loc);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        $zip-&gt;decompress();</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">case</span> <span class="stringliteral">&#39;tar&#39;</span>:</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        $zip = new \PharData($loc);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    $zip-&gt;extractTo($unzip_dir);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    $dir = $unzip_dir;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    $files = scandir($dir);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span> ($files and count($files) == 3 and is_dir($dir . <span class="charliteral">&#39;/&#39;</span> . $files[2])) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      $dir .= <span class="charliteral">&#39;/&#39;</span> . $files[2];</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      $files = scandir($dir);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">foreach</span> ($files as $key =&gt; $name) {</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    $files[$key] = $dir . <span class="charliteral">&#39;/&#39;</span> . $name;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordflow">return</span> $files;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_aab568bce2ab8f3f321b3379fab168421"><div class="ttname"><a href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a></div><div class="ttdeci">tpps_get_path_extension($path)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00645">file_utils.inc:645</a></div></div>
<div class="ttc" id="file__utils_8inc_html_ac3b2a0284d8f175fa87b03595b2c6ee5"><div class="ttname"><a href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a></div><div class="ttdeci">tpps_rmdir($dir)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00863">file_utils.inc:863</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acdf6d662ed7a3c794957ac802f740236"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_get_location </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets true file path from a uri or Drupal file stream.</p>
<p>If the file is compressed, extracts the archive and returns the path of the extracted file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$location</td><td>The uri or file stream of the file we want the location of. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The true path of the file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00624">624</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                      {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  $location = drupal_realpath($location);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  $extension = <a class="code" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a>($location);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">if</span> ($extension == <span class="stringliteral">&#39;zip&#39;</span> or $extension == <span class="stringliteral">&#39;gz&#39;</span> or $extension == <span class="stringliteral">&#39;tar&#39;</span>) {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    $files = <a class="code" href="file__utils_8inc.html#a3400c252f893838d83ffe4b56bd23d44">tpps_get_archive_files</a>($location);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span> ($files and count($files) == 3 and !is_dir($files[2])) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      $location = $files[2];</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">return</span> $location;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a3400c252f893838d83ffe4b56bd23d44"><div class="ttname"><a href="file__utils_8inc.html#a3400c252f893838d83ffe4b56bd23d44">tpps_get_archive_files</a></div><div class="ttdeci">tpps_get_archive_files($archive)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00890">file_utils.inc:890</a></div></div>
<div class="ttc" id="file__utils_8inc_html_aab568bce2ab8f3f321b3379fab168421"><div class="ttname"><a href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a></div><div class="ttdeci">tpps_get_path_extension($path)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00645">file_utils.inc:645</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aab568bce2ab8f3f321b3379fab168421"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_get_path_extension </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets the file extension from a path.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$path</td><td>The path of the file we want the extension of.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The extension of that file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00645">645</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                        {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  preg_match(<span class="stringliteral">&#39;/\.([a-zA-Z0-9]*)$/&#39;</span>, $path, $matches);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">return</span> strtolower($matches[1]);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a04798048750e2b7829434f790df3c040"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_increment_hex </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$hex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function increments a hexidecimal key.</p>
<p>The function expects a hexidecimal encoding of a capital alphabetical key. For example, you might pass "$hex = unpack('H*', 'A')[1];". This function is intended to be used for parsed file keys. Here are some examples: echo pack('H*', tpps_increment_hex(unpack('H*', 'A')[1])); // B echo pack('H*', tpps_increment_hex(unpack('H*', 'AA')[1])); // AB echo pack('H*', tpps_increment_hex(unpack('H*', 'Z')[1])); // AA echo pack('H*', tpps_increment_hex(unpack('H*', 'AZ')[1])); // BA echo pack('H*', tpps_increment_hex(unpack('H*', 'ZZZ')[1])); // AAAA.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$hex</td><td>The hexidecimal encoding of a capital alphabetical key.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The encoding of the next capital alphabetical key. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00216">216</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                                  {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  $add = 1;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  $new = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">for</span> ($i = strlen(pack(<span class="stringliteral">&#39;H*&#39;</span>, $hex)) - 1; $i &gt;= 0; $i--) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    $num = base_convert(substr($hex, (2 * $i), 2), 16, 10) + $add;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> ($num &gt; 90) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      $num = 65;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      $add = 0;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    $new = base_convert($num, 10, 16) . $new;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> ($i == 0 and $add) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      $new = <span class="stringliteral">&#39;41&#39;</span> . $new;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">return</span> $new;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a42b4df00b61325b2402990d6b361da92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_parse_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$max_rows</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$no_header</em> = <code>FALSE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$columns</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function parses a file and returns an array of its content.</p>
<p>The process of actually parsing the file is done with the use of helper functions, and this function returns the results.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file identifier of the file to be parsed. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$max_rows</td><td>The maximum number of rows to read from the file. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$no_header</td><td>Whether or not the file has a "no_header" flag set.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array An array containing the content headers and content body. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00024">24</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                                                                                   {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  $content = array();</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  $options = array(</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="stringliteral">&#39;no_header&#39;</span> =&gt; $no_header,</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="stringliteral">&#39;columns&#39;</span> =&gt; $columns,</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="stringliteral">&#39;max_rows&#39;</span> =&gt; $max_rows,</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="stringliteral">&#39;content&#39;</span> =&gt; &amp;$content,</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  );</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a>($fid, <span class="stringliteral">&#39;tpps_parse_file_helper&#39;</span>, $options);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  $content[<span class="stringliteral">&#39;headers&#39;</span>] = <a class="code" href="file__utils_8inc.html#ab3aaa23338a57219a37369743bcdd1ab">tpps_file_headers</a>($fid, $no_header);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">return</span> $content;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_ab3aaa23338a57219a37369743bcdd1ab"><div class="ttname"><a href="file__utils_8inc.html#ab3aaa23338a57219a37369743bcdd1ab">tpps_file_headers</a></div><div class="ttdeci">tpps_file_headers($fid, $no_header=FALSE)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00950">file_utils.inc:950</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a2dbdebe050f31627585ffe69727c8fff"><div class="ttname"><a href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a></div><div class="ttdeci">tpps_file_iterator($fid, $function, array &amp;$options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00989">file_utils.inc:989</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6176e642def9ba548e7b0a8c1fb01026"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_parse_file_column </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$column</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$no_header</em> = <code>FALSE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parses a single column from a file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file identifier of the file to be parsed. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$column</td><td>The alphabetical key of the column to be parsed. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$no_header</td><td>Whether or not the no_header options has been set to true for the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array An array of values found in the parsed column. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00314">314</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                                                   {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  $content = array();</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  $options = array(</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="stringliteral">&#39;no_header&#39;</span> =&gt; $no_header,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="stringliteral">&#39;columns&#39;</span> =&gt; array($column),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="stringliteral">&#39;content&#39;</span> =&gt; &amp;$content,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  );</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a>($fid, <span class="stringliteral">&#39;tpps_parse_file_column_helper&#39;</span>, $options);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">return</span> $content;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a2dbdebe050f31627585ffe69727c8fff"><div class="ttname"><a href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator</a></div><div class="ttdeci">tpps_file_iterator($fid, $function, array &amp;$options=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00989">file_utils.inc:989</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7a61b7b422f74d54c5e14b3f00a34ec6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_parse_file_column_helper </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$row</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function processes a single row of a file.</p>
<p>This function populates the content attribute of the options array with the data in a single column. This function is meant to be used with <a class="el" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$row</td><td>The item yielded by the TPPS file generator. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options set when calling <a class="el" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator()</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00337">337</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                                        {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  $options[<span class="stringliteral">&#39;content&#39;</span>][] = $row[current($options[<span class="stringliteral">&#39;columns&#39;</span>])];</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3162a76ee851e1f8691b98d1dcf4e3f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_parse_file_helper </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$row</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function processes a single row of a file.</p>
<p>This function populates the content attribute of the options array with content returned by the TPPS file generator. It is used by both the tpps_parse_file and the tpps_file_headers functions. This function is meant to be used with <a class="el" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$row</td><td>The item yielded by the TPPS file generator. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options set when calling <a class="el" href="file__utils_8inc.html#a2dbdebe050f31627585ffe69727c8fff">tpps_file_iterator()</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00051">51</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                                 {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  $options[<span class="stringliteral">&#39;content&#39;</span>][] = $row;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad36de4423e30ab4fa6985458240d7e68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_rename_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$new_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Renames a Drupal managed file.</p>
<p>If the "preserve" option is set to true, then the new file will be created as a copy of the old one. Otherwise, the old file will be removed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The Drupal managed file identifier of the file to be renamed. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$new_name</td><td>The new name of the file. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options to be used when renaming the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>object The new Drupal managed file object. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00279">279</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                                                     {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span> (!array_key_exists(<span class="stringliteral">&#39;preserve&#39;</span>, $options)) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    $options[<span class="stringliteral">&#39;preserve&#39;</span>] = FALSE;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">if</span> (!empty($fid) and ($file = file_load($fid))) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    $new_filename = $new_name . <span class="stringliteral">&quot;.&quot;</span> . <a class="code" href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a>($file-&gt;uri);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/^(.*\/)(.*)$/&#39;</span>, $new_name, $matches)) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      preg_match(<span class="stringliteral">&#39;/^(.*\/).*$/&#39;</span>, $file-&gt;uri, $matches);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      $new_filename = $matches[1] . $new_filename;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;preserve&#39;</span>]) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      $file-&gt;status = FILE_STATUS_PERMANENT;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      file_save($file);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> file_copy($file, $new_filename);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">return</span> file_move($file, $new_filename);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Error: could not open file&quot;</span>);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_aab568bce2ab8f3f321b3379fab168421"><div class="ttname"><a href="file__utils_8inc.html#aab568bce2ab8f3f321b3379fab168421">tpps_get_path_extension</a></div><div class="ttdeci">tpps_get_path_extension($path)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00645">file_utils.inc:645</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac3b2a0284d8f175fa87b03595b2c6ee5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_rmdir </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Recursively removes a directory.</p>
<p>We want to clean out the temporary tpps_xlsx directory when we are done with an excel file, so we need to recursively remove all of the links and sub- directories. Use this function with caution.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$dir</td><td>The directory to be removed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00863">863</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                          {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordflow">if</span> (is_dir($dir)) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    $children = scandir($dir);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">foreach</span> ($children as $child) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> ($child != <span class="charliteral">&#39;.&#39;</span> and $child != <span class="stringliteral">&#39;..&#39;</span>) {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keywordflow">if</span> (is_dir($dir . <span class="charliteral">&#39;/&#39;</span> . $child) and !is_link($dir . <span class="charliteral">&#39;/&#39;</span> . $child)) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          <a class="code" href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a>($dir . <span class="charliteral">&#39;/&#39;</span> . $child);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          unlink($dir . <span class="charliteral">&#39;/&#39;</span> . $child);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    rmdir($dir);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_ac3b2a0284d8f175fa87b03595b2c6ee5"><div class="ttname"><a href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a></div><div class="ttdeci">tpps_rmdir($dir)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00863">file_utils.inc:863</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae817c2bfb237f057a9b36a5d2ff3d3ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_save_file_columns </td>
          <td>(</td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$form</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$form_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Saves file column selections to the values of the form_state.</p>
<p>This function is called before the form is validated so that the column options can be saved whenever the user makes a selection.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$form</td><td>The form being validated. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$form_state</td><td>The state of the form being validated. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00518">518</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                                                  {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span> ($form_state[<span class="stringliteral">&#39;stage&#39;</span>] == <a class="code" href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a>) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">for</span> ($i = 1; $i &lt;= $form_state[<span class="stringliteral">&#39;stats&#39;</span>][<span class="stringliteral">&#39;species_count&#39;</span>]; $i++) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (($file = file_load($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>])) and $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>] != 0) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        file_usage_add($file, <span class="stringliteral">&#39;tpps&#39;</span>, <span class="stringliteral">&#39;tpps_project&#39;</span>, substr($form_state[<span class="stringliteral">&#39;accession&#39;</span>], 4));</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file-columns&#39;</span>] = array();</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>])) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">foreach</span> ($form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>] as $col =&gt; $val) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;          <span class="keywordflow">if</span> ($col[0] != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file-columns&#39;</span>][$col] = $form[<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&quot;species-$i&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>][$col];</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">if</span> (empty($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&#39;tree-accession&#39;</span>][<span class="stringliteral">&#39;check&#39;</span>])) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  elseif ($form_state[<span class="stringliteral">&#39;stage&#39;</span>] == <a class="code" href="tpps_8module.html#a1a0b618b0cc8e20078ea6112770594f8">TPPS_PAGE_4</a>) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&#39;organism-1&#39;</span>][<span class="stringliteral">&#39;genotype&#39;</span>])) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">for</span> ($i = 1; $i &lt;= $form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#afc7626d0d50cc6f3389e67ff010c6d23">TPPS_PAGE_1</a>][<span class="stringliteral">&#39;organism&#39;</span>][<span class="stringliteral">&#39;number&#39;</span>]; $i++) {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">if</span> (!empty($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay&#39;</span>]) and ($file = file_load($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay&#39;</span>]))) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          file_usage_add($file, <span class="stringliteral">&#39;tpps&#39;</span>, <span class="stringliteral">&#39;tpps_project&#39;</span>, substr($form_state[<span class="stringliteral">&#39;accession&#39;</span>], 4));</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay-columns&#39;</span>] = array();</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>])) {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="keywordflow">foreach</span> ($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>] as $col =&gt; $val) {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;              <span class="keywordflow">if</span> ($col[0] != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay-columns&#39;</span>][$col] = $form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;snps-assay&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>][$col];</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;              }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">if</span> (!empty($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other&#39;</span>]) and ($file = file_load($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other&#39;</span>]))) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          file_usage_add($file, <span class="stringliteral">&#39;tpps&#39;</span>, <span class="stringliteral">&#39;tpps_project&#39;</span>, substr($form_state[<span class="stringliteral">&#39;accession&#39;</span>], 4));</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;          $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other-columns&#39;</span>] = array();</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>])) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">foreach</span> ($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>] as $col =&gt; $val) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;              <span class="keywordflow">if</span> ($col[0] != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other-columns&#39;</span>][$col] = $form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;genotype&#39;</span>][<span class="stringliteral">&#39;files&#39;</span>][<span class="stringliteral">&#39;other&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>][$col];</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;              }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        }</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&#39;organism-1&#39;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>])) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">for</span> ($i = 1; $i &lt;= $form_state[<span class="stringliteral">&#39;saved_values&#39;</span>][<a class="code" href="tpps_8module.html#afc7626d0d50cc6f3389e67ff010c6d23">TPPS_PAGE_1</a>][<span class="stringliteral">&#39;organism&#39;</span>][<span class="stringliteral">&#39;number&#39;</span>]; $i++) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span> (!isset($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;iso&#39;</span>])) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          <span class="keywordflow">if</span> (($file = file_load($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>])) and $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>] != 0) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            file_usage_add($file, <span class="stringliteral">&#39;tpps&#39;</span>, <span class="stringliteral">&#39;tpps_project&#39;</span>, substr($form_state[<span class="stringliteral">&#39;accession&#39;</span>], 4));</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file-columns&#39;</span>] = array();</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>])) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordflow">foreach</span> ($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>] as $col =&gt; $val) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;              <span class="keywordflow">if</span> ($col[0] != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file-columns&#39;</span>][$col] = $form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>][$col];</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;              }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;          }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          <span class="keywordflow">if</span> ($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;check&#39;</span>] != <span class="charliteral">&#39;0&#39;</span>) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="keywordflow">if</span> (($file = file_load($form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata&#39;</span>])) and $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata&#39;</span>] != 0) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;              file_usage_add($file, <span class="stringliteral">&#39;tpps&#39;</span>, <span class="stringliteral">&#39;tpps_project&#39;</span>, substr($form_state[<span class="stringliteral">&#39;accession&#39;</span>], 4));</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata-columns&#39;</span>] = array();</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="keywordflow">if</span> (isset($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>])) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;              <span class="keywordflow">foreach</span> ($form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>] as $col =&gt; $val) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="keywordflow">if</span> ($col[0] != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                  $form_state[<span class="stringliteral">&#39;values&#39;</span>][<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata-columns&#39;</span>][$col] = $form[<span class="stringliteral">&quot;organism-$i&quot;</span>][<span class="stringliteral">&#39;phenotype&#39;</span>][<span class="stringliteral">&#39;metadata&#39;</span>][<span class="stringliteral">&#39;#value&#39;</span>][<span class="stringliteral">&#39;columns&#39;</span>][$col];</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;              }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      }</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;}</div><div class="ttc" id="tpps_8module_html_afc7626d0d50cc6f3389e67ff010c6d23"><div class="ttname"><a href="tpps_8module.html#afc7626d0d50cc6f3389e67ff010c6d23">TPPS_PAGE_1</a></div><div class="ttdeci">const TPPS_PAGE_1</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00012">tpps.module:12</a></div></div>
<div class="ttc" id="tpps_8module_html_a1a0b618b0cc8e20078ea6112770594f8"><div class="ttname"><a href="tpps_8module.html#a1a0b618b0cc8e20078ea6112770594f8">TPPS_PAGE_4</a></div><div class="ttdeci">const TPPS_PAGE_4</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00015">tpps.module:15</a></div></div>
<div class="ttc" id="tpps_8module_html_aee3f84bc39f996a79a7937348f3fd014"><div class="ttname"><a href="tpps_8module.html#aee3f84bc39f996a79a7937348f3fd014">TPPS_PAGE_3</a></div><div class="ttdeci">const TPPS_PAGE_3</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00014">tpps.module:14</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6d5cd2d23ff3c3c58cd7c926dbed0cb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_generator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is a generator for xlsx files.</p>
<p>If the 'max_rows' option is set, the generator stop after max_rows items are yielded. If the 'columns' option is set, then each item yielded by the generator will contain only the specified columns from the row.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$location</td><td>The location of the file on the server. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options detailing how to parse the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Generator|array Yields each row of the file (or columns of a row, if applicable). </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l01059">1059</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                                                                  {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  $dir = drupal_realpath(<a class="code" href="tpps_8module.html#ac79b5023a5547c7592cb9530f330abe6">TPPS_TEMP_XLSX</a>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  $no_header = $options[<span class="stringliteral">&#39;no_header&#39;</span>] ?? FALSE;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  $columns = $options[<span class="stringliteral">&#39;columns&#39;</span>] ?? NULL;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  $max_rows = $options[<span class="stringliteral">&#39;max_rows&#39;</span>] ?? NULL;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">if</span> (!empty($columns)) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    $new_columns = array();</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">foreach</span> ($columns as $col) {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      $new_columns[$col] = $col;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    }</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    $columns = $new_columns;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  $zip = <span class="keyword">new</span> ZipArchive();</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  $zip-&gt;open($location);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  $zip-&gt;extractTo($dir);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  $strings_location = $dir . <span class="stringliteral">&#39;/xl/sharedStrings.xml&#39;</span>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">// Find all worksheets.</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  $sheets = scandir($dir . <span class="stringliteral">&#39;/xl/worksheets&#39;</span>);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  unset($sheets[array_search(<span class="charliteral">&#39;.&#39;</span>, $sheets)]);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  unset($sheets[array_search(<span class="stringliteral">&#39;..&#39;</span>, $sheets)]);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  $strings = <a class="code" href="file__utils_8inc.html#aeb48dfcbe1da9e76d38c6eee361bc230">tpps_xlsx_get_strings</a>($strings_location);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="comment">// Get dimensions, readers.</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  $first_left = NULL;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  $last_right = NULL;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  $dims = array();</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  $readers = array();</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordflow">foreach</span> ($sheets as $sheet) {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    $loc = $dir . <span class="stringliteral">&#39;/xl/worksheets/&#39;</span> . $sheet;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    $dimension = <a class="code" href="file__utils_8inc.html#afe0df5b92f8425efc2d3cd9940bc1e51">tpps_xlsx_get_dimension</a>($loc);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    preg_match(<span class="stringliteral">&#39;/([A-Z]+)[0-9]+:([A-Z]+)[0-9]+/&#39;</span>, $dimension, $matches);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    $left_hex = unpack(<span class="stringliteral">&#39;H*&#39;</span>, $matches[1]);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    $hex = $left_hex[1];</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    $right_hex = unpack(<span class="stringliteral">&#39;H*&#39;</span>, $matches[2]);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">if</span> ($first_left == NULL) {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      $first_left = $left_hex[1];</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      $last_right = $left_hex[1] - 1;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">while</span> (base_convert($hex, 16, 10) &lt;= base_convert($right_hex[1], 16, 10)) {</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      $hex = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($hex);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      $last_right = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($last_right);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    $dims[] = array($left_hex[1], $right_hex[1]);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    $reader = <span class="keyword">new</span> XMLReader();</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    $reader-&gt;open($loc);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    $readers[] = $reader;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// If the file has a header row, skip it.</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordflow">if</span> (!$no_header) {</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="file__utils_8inc.html#a25959c1e5bdea2a2091d588f73921aba">tpps_xlsx_get_rows</a>($readers, $strings);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="comment">// Iterate through file.</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  $count = 0;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="keywordflow">while</span> (($rows = <a class="code" href="file__utils_8inc.html#a25959c1e5bdea2a2091d588f73921aba">tpps_xlsx_get_rows</a>($readers, $strings, TRUE, $columns))) {</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">if</span> (!empty($max_rows) and $count &gt;= $max_rows){</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    $count++;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    $values = array();</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    $key_hex = $first_left;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">foreach</span> ($readers as $idx =&gt; $read) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      $row = $rows[$idx];</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">if</span> (!empty($row)) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        ksort($row);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      }</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      $hex = $dims[$idx][0];</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <span class="keywordflow">while</span> (base_convert($hex, 16, 10) &lt;= base_convert($dims[$idx][1], 16, 10)) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        $key = pack(<span class="stringliteral">&#39;H*&#39;</span>, $key_hex);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        $row_key = pack(<span class="stringliteral">&#39;H*&#39;</span>, $hex);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">if</span> (empty($columns) or array_search($key, $columns) !== FALSE) {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          $values[$key] = isset($row[$row_key]) ? trim($row[$row_key]) : NULL;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        }</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        $hex = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($hex);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        $key_hex = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($key_hex);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      }</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    yield $values;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  }</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="comment">// Close readers.</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="keywordflow">foreach</span> ($readers as $reader) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    $reader-&gt;close();</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  }</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <a class="code" href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a>($dir);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a04798048750e2b7829434f790df3c040"><div class="ttname"><a href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a></div><div class="ttdeci">tpps_increment_hex($hex)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00216">file_utils.inc:216</a></div></div>
<div class="ttc" id="tpps_8module_html_ac79b5023a5547c7592cb9530f330abe6"><div class="ttname"><a href="tpps_8module.html#ac79b5023a5547c7592cb9530f330abe6">TPPS_TEMP_XLSX</a></div><div class="ttdeci">const TPPS_TEMP_XLSX</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00016">tpps.module:16</a></div></div>
<div class="ttc" id="file__utils_8inc_html_a25959c1e5bdea2a2091d588f73921aba"><div class="ttname"><a href="file__utils_8inc.html#a25959c1e5bdea2a2091d588f73921aba">tpps_xlsx_get_rows</a></div><div class="ttdeci">tpps_xlsx_get_rows(&amp;$readers, &amp;$strings=array(), $plain=TRUE, $columns=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00693">file_utils.inc:693</a></div></div>
<div class="ttc" id="file__utils_8inc_html_aeb48dfcbe1da9e76d38c6eee361bc230"><div class="ttname"><a href="file__utils_8inc.html#aeb48dfcbe1da9e76d38c6eee361bc230">tpps_xlsx_get_strings</a></div><div class="ttdeci">tpps_xlsx_get_strings($strings_location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00832">file_utils.inc:832</a></div></div>
<div class="ttc" id="file__utils_8inc_html_afe0df5b92f8425efc2d3cd9940bc1e51"><div class="ttname"><a href="file__utils_8inc.html#afe0df5b92f8425efc2d3cd9940bc1e51">tpps_xlsx_get_dimension</a></div><div class="ttdeci">tpps_xlsx_get_dimension($location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00661">file_utils.inc:661</a></div></div>
<div class="ttc" id="file__utils_8inc_html_ac3b2a0284d8f175fa87b03595b2c6ee5"><div class="ttname"><a href="file__utils_8inc.html#ac3b2a0284d8f175fa87b03595b2c6ee5">tpps_rmdir</a></div><div class="ttdeci">tpps_rmdir($dir)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00863">file_utils.inc:863</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7b81987f3b85a902ea5542b66345398c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_get_cell_value </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$reader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$cell_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$strings</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns a cell value from an XML file.</p>
<p>This function recieves an XMLReader object, a cell type attribute, and a location for a strings XML file, and returns the value of the current cell. If the cell type is a string, then the function returns the string from the strings file with the matching string id. Otherwise, it returns the inner XML from the 'v' element within the cell. If no 'v' element can be found before the end of the cell, it returns NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">object</td><td class="paramname">$reader</td><td>The XMLReader object being used to read the XML file. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$cell_type</td><td>The 't' attribute of the current cell. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$strings</td><td>The cached strings for the current XML file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed Either the value in the 'v' element of the cell or the associated string. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00806">806</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                                                                                   {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordflow">if</span> ($reader-&gt;isEmptyElement) {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordflow">while</span> (!($reader-&gt;nodeType == XMLReader::END_ELEMENT and ($reader-&gt;name == <span class="charliteral">&#39;c&#39;</span> or $reader-&gt;name == <span class="stringliteral">&#39;row&#39;</span>)) and $reader-&gt;read()) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span> ($reader-&gt;nodeType == XMLReader::ELEMENT and $reader-&gt;name == <span class="charliteral">&#39;v&#39;</span>) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      $value = $reader-&gt;readInnerXml();</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="keywordflow">if</span> (!empty($cell_type) and $cell_type == <span class="charliteral">&#39;s&#39;</span>) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        $value = $strings[$value];</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">return</span> $value;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afe0df5b92f8425efc2d3cd9940bc1e51"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_get_dimension </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the dimension string of an xlsx file.</p>
<p>If the dimension string cannot be found, returns NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$location</td><td>The location of the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed The dimension string of the file, or NULL if it cannot be found. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00661">661</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                            {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  $reader = <span class="keyword">new</span> XMLReader();</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  $reader-&gt;open($location);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordflow">while</span> ($reader-&gt;read()) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> ($reader-&gt;nodeType == XMLReader::ELEMENT and $reader-&gt;name == <span class="stringliteral">&#39;dimension&#39;</span>) {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      $dim = $reader-&gt;getAttribute(<span class="stringliteral">&#39;ref&#39;</span>);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      $reader-&gt;close();</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">return</span> $dim;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac918f4fcada1230489f270904c4c0e63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_get_row </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$reader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$strings</em> = <code>array()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$plain</em> = <code>TRUE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$columns</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieves a single "row" from an XML file.</p>
<p>This function recieves an XMLReader object and a location for a strings XML file, and returns an array of cell values. If the $plain parameter is set to FALSE, then the function will return TRUE when the XMLReader cursor is on the next row element. If no row element can be found, the function returns FALSE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">object</td><td class="paramname">$reader</td><td>The XMLReader object being used to read the XML file. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$strings</td><td>The cached strings for the current XML file. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$plain</td><td>Whether or not to attempt to return an array of cell values, or just TRUE. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$columns</td><td>An array of columns to return. If NULL, return all columns.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed If $plain is set to TRUE, an array of cell values. Otherwise TRUE. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00734">734</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                                                                                          {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordflow">while</span> ($reader-&gt;read()) {</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">if</span> ($reader-&gt;nodeType == XMLReader::ELEMENT and $reader-&gt;name == <span class="stringliteral">&#39;row&#39;</span>) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordflow">if</span> ($plain) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        $cells = array();</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">while</span> (!($reader-&gt;nodeType == XMLReader::END_ELEMENT and $reader-&gt;name == <span class="stringliteral">&#39;row&#39;</span>) and $reader-&gt;read()) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <span class="keywordflow">if</span> ($reader-&gt;nodeType == XMLReader::ELEMENT and $reader-&gt;name == <span class="charliteral">&#39;c&#39;</span>) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            $cell_type = $reader-&gt;getAttribute(<span class="charliteral">&#39;t&#39;</span>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            preg_match(<span class="stringliteral">&#39;/([A-Z]+)([0-9]+)/&#39;</span>, $reader-&gt;getAttribute(<span class="charliteral">&#39;r&#39;</span>), $matches);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            $cell_location = $matches[1];</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="keywordflow">if</span> (!empty($columns) and !isset($columns[$cell_location])) {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            }</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            $cells[$cell_location] = <a class="code" href="file__utils_8inc.html#a7b81987f3b85a902ea5542b66345398c">tpps_xlsx_get_cell_value</a>($reader, $cell_type, $strings);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">return</span> $cells;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keywordflow">return</span> TRUE;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    }</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  }</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">return</span> FALSE;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a7b81987f3b85a902ea5542b66345398c"><div class="ttname"><a href="file__utils_8inc.html#a7b81987f3b85a902ea5542b66345398c">tpps_xlsx_get_cell_value</a></div><div class="ttdeci">tpps_xlsx_get_cell_value(&amp;$reader, $cell_type, array &amp;$strings=array())</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00806">file_utils.inc:806</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25959c1e5bdea2a2091d588f73921aba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_get_rows </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$readers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$strings</em> = <code>array()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$plain</em> = <code>TRUE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$columns</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieves rows from array of readers.</p>
<p>This function recieves an array of XMLReader objects and an array of cached strings, and returns an array of rows produced by <a class="el" href="file__utils_8inc.html#ac918f4fcada1230489f270904c4c0e63">tpps_xlsx_get_row()</a> from each reader.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$readers</td><td>The array of XMLReader objects. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$strings</td><td>The cached strings for the current XML file. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$plain</td><td>Whether or not to attempt to return an array of cell values, or just TRUE. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$columns</td><td>An array of columns to return. If NULL, return all columns.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed If $plain is set to TRUE, an array of cell values. Otherwise TRUE. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00693">693</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                                                                                            {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  $rows = array();</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  $empty = TRUE;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">foreach</span> ($readers as $key =&gt; $r) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    $reader = &amp;$readers[$key];</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    $row = <a class="code" href="file__utils_8inc.html#ac918f4fcada1230489f270904c4c0e63">tpps_xlsx_get_row</a>($reader, $strings, $plain, $columns);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> ($row) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      $rows[$key] = $row;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      $empty = FALSE;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      $rows[$key] = NULL;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">if</span> ($empty) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">return</span> FALSE;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">return</span> $rows;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_ac918f4fcada1230489f270904c4c0e63"><div class="ttname"><a href="file__utils_8inc.html#ac918f4fcada1230489f270904c4c0e63">tpps_xlsx_get_row</a></div><div class="ttdeci">tpps_xlsx_get_row(&amp;$reader, &amp;$strings=array(), $plain=TRUE, $columns=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00734">file_utils.inc:734</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeb48dfcbe1da9e76d38c6eee361bc230"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_get_strings </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$strings_location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieves strings from an excel strings XML file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$strings_location</td><td>The location of the strings XML file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The strings from the strings XML file. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00832">832</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                                  {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  $strings = array();</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  $reader = <span class="keyword">new</span> XMLReader();</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  $reader-&gt;open($strings_location);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  $count = 0;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">while</span> ($reader-&gt;read()) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span> ($reader-&gt;nodeType == XMLReader::ELEMENT and $reader-&gt;name == <span class="stringliteral">&#39;si&#39;</span>) {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      $string = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="keywordflow">while</span> (!($reader-&gt;nodeType == XMLReader::END_ELEMENT and $reader-&gt;name == <span class="stringliteral">&#39;si&#39;</span>) and $reader-&gt;read()) {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordflow">if</span> ($reader-&gt;nodeType == XMLReader::ELEMENT and $reader-&gt;name == <span class="charliteral">&#39;t&#39;</span>) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;          $string .= $reader-&gt;readInnerXml();</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        }</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      }</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      $strings[$count++] = $string;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  $reader-&gt;close();</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">return</span> $strings;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a65da39eb37cedbb6c9fce5c088bbf665"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_translate_date </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$date</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Translates the date from an .xlsx file.</p>
<p>This function may seem strange at first, but skips $date = 60 on purpose. Day 60 in Excel's encoding represents 2/29/1900, which is not a real date.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$date</td><td>The date to be translated.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed The original date provided, a re-formated date, or NULL on failure. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00770">770</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                         {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordflow">if</span> (strtotime($date) !== FALSE) {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">return</span> $date;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordflow">if</span> ($date &gt; 60) {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    $date = $date - 1;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">return</span> date(<span class="stringliteral">&quot;m/d/Y&quot;</span>, strtotime(<span class="stringliteral">&quot;12/31/1899 +$date days&quot;</span>));</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordflow">if</span> ($date &lt; 60) {</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">return</span> date(<span class="stringliteral">&quot;m/d/Y&quot;</span>, strtotime(<span class="stringliteral">&quot;12/31/1899 +$date days&quot;</span>));</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a381868684e1030cc0c461c25a5789b7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_xlsx_width </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function gets the length of the longest line of an xlsx file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$location</td><td>The location of the file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int The length of the longest line. </dd></dl>

<p>Definition at line <a class="el" href="file__utils_8inc_source.html#l00146">146</a> of file <a class="el" href="file__utils_8inc_source.html">file_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                    {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  $dir = drupal_realpath(<a class="code" href="tpps_8module.html#ac79b5023a5547c7592cb9530f330abe6">TPPS_TEMP_XLSX</a>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  $zip = <span class="keyword">new</span> ZipArchive();</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  $zip-&gt;open($location);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  $zip-&gt;extractTo($dir);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  $data_location = $dir . <span class="stringliteral">&#39;/xl/worksheets/sheet1.xml&#39;</span>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  $dimension = <a class="code" href="file__utils_8inc.html#afe0df5b92f8425efc2d3cd9940bc1e51">tpps_xlsx_get_dimension</a>($data_location);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  preg_match(<span class="stringliteral">&#39;/([A-Z]+)[0-9]+:([A-Z]+)[0-9]+/&#39;</span>, $dimension, $matches);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  $left_hex = unpack(<span class="stringliteral">&#39;H*&#39;</span>, $matches[1]);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  $hex = $left_hex[1];</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  $right_hex = unpack(<span class="stringliteral">&#39;H*&#39;</span>, $matches[2]);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  $len = 0;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">while</span> (base_convert($hex, 16, 10) &lt;= base_convert($right_hex[1], 16, 10)) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    $len++;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    $hex = <a class="code" href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a>($hex);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">return</span> $len;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="ttc" id="file__utils_8inc_html_a04798048750e2b7829434f790df3c040"><div class="ttname"><a href="file__utils_8inc.html#a04798048750e2b7829434f790df3c040">tpps_increment_hex</a></div><div class="ttdeci">tpps_increment_hex($hex)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00216">file_utils.inc:216</a></div></div>
<div class="ttc" id="tpps_8module_html_ac79b5023a5547c7592cb9530f330abe6"><div class="ttname"><a href="tpps_8module.html#ac79b5023a5547c7592cb9530f330abe6">TPPS_TEMP_XLSX</a></div><div class="ttdeci">const TPPS_TEMP_XLSX</div><div class="ttdef"><b>Definition:</b> <a href="tpps_8module_source.html#l00016">tpps.module:16</a></div></div>
<div class="ttc" id="file__utils_8inc_html_afe0df5b92f8425efc2d3cd9940bc1e51"><div class="ttname"><a href="file__utils_8inc.html#afe0df5b92f8425efc2d3cd9940bc1e51">tpps_xlsx_get_dimension</a></div><div class="ttdeci">tpps_xlsx_get_dimension($location)</div><div class="ttdef"><b>Definition:</b> <a href="file__utils_8inc_source.html#l00661">file_utils.inc:661</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_09e761304027c904456130627fd4dcf5.html">includes</a></li><li class="navelem"><a class="el" href="file__utils_8inc.html">file_utils.inc</a></li>
    <li class="footer">Generated on Tue Aug 17 2021 13:51:57 for Tripal Plant PopGen Submit by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
