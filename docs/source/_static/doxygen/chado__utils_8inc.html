<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tripal Plant PopGen Submit: /var/www/html/sites/all/modules/TGDR/includes/chado_utils.inc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tripal Plant PopGen Submit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('chado__utils_8inc.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">chado_utils.inc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="chado__utils_8inc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a89b5497742e4904bf3404ea76a1ae62c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a89b5497742e4904bf3404ea76a1ae62c">tpps_add_project_file</a> (array &amp;$state, &amp;$fid)</td></tr>
<tr class="separator:a89b5497742e4904bf3404ea76a1ae62c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ee13a630c6758f97878467f7a2df479"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a7ee13a630c6758f97878467f7a2df479">tpps_chado_insert_multi</a> (array $record_groups, array $options=array())</td></tr>
<tr class="separator:a7ee13a630c6758f97878467f7a2df479"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97efcdeca8e6cb331a0434876881b713"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a97efcdeca8e6cb331a0434876881b713">tpps_chado_insert_record</a> ($table, $records, array $options=array())</td></tr>
<tr class="separator:a97efcdeca8e6cb331a0434876881b713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d1ac62713fda5ab9ae6b4fab2637498"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a6d1ac62713fda5ab9ae6b4fab2637498">tpps_chado_prop_exists</a> ($base_table, $id, $name, array $options=array())</td></tr>
<tr class="separator:a6d1ac62713fda5ab9ae6b4fab2637498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32510acf7177b9adcb53575b09b1749a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a32510acf7177b9adcb53575b09b1749a">tpps_get_taxon</a> ($org_name, $rank)</td></tr>
<tr class="separator:a32510acf7177b9adcb53575b09b1749a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68e5adbe9c2c69f23984f87909fe08b1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a68e5adbe9c2c69f23984f87909fe08b1">tpps_table_columns</a> ($table)</td></tr>
<tr class="separator:a68e5adbe9c2c69f23984f87909fe08b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840bc175665125f5098ada021bda08cd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chado__utils_8inc.html#a840bc175665125f5098ada021bda08cd">tpps_tripal_entity_publish</a> ($bundle_name, array $vals, array $options=array())</td></tr>
<tr class="separator:a840bc175665125f5098ada021bda08cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines useful functions that interact with Chado. </p>

<p class="definition">Definition in file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a89b5497742e4904bf3404ea76a1ae62c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89b5497742e4904bf3404ea76a1ae62c">&#9670;&nbsp;</a></span>tpps_add_project_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_add_project_file </td>
          <td>(</td>
          <td class="paramtype">array &amp;&#160;</td>
          <td class="paramname"><em>$state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$fid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a file path as a projectprop to a submission.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$state</td><td>The TPPS submission associated with the file. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$fid</td><td>The managed file id number. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00513">513</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                                     {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  $file = file_load($fid) ?? NULL;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">if</span> ($file) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="chado__utils_8inc.html#a97efcdeca8e6cb331a0434876881b713">tpps_chado_insert_record</a>(<span class="stringliteral">&#39;projectprop&#39;</span>, array(</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="stringliteral">&#39;project_id&#39;</span> =&gt; $state[<span class="stringliteral">&#39;ids&#39;</span>][<span class="stringliteral">&#39;project_id&#39;</span>],</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="stringliteral">&#39;type_id&#39;</span> =&gt; <a class="code" href="cvterm__utils_8inc.html#a9c920f817e935cf101063a1645b73343">tpps_load_cvterm</a>(<span class="stringliteral">&#39;file_path&#39;</span>)-&gt;cvterm_id,</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="stringliteral">&#39;value&#39;</span> =&gt; file_create_url($file-&gt;uri),</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="stringliteral">&#39;rank&#39;</span> =&gt; $state[<span class="stringliteral">&#39;file_rank&#39;</span>],</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    ));</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    $state[<span class="stringliteral">&#39;file_rank&#39;</span>]++;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span> (!empty($state[<span class="stringliteral">&#39;revised_files&#39;</span>][$fid]) and ($file = file_load($state[<span class="stringliteral">&#39;revised_files&#39;</span>][$fid]))) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    $fid = $state[<span class="stringliteral">&#39;revised_files&#39;</span>][$fid];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <a class="code" href="chado__utils_8inc.html#a97efcdeca8e6cb331a0434876881b713">tpps_chado_insert_record</a>(<span class="stringliteral">&#39;projectprop&#39;</span>, array(</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="stringliteral">&#39;project_id&#39;</span> =&gt; $state[<span class="stringliteral">&#39;ids&#39;</span>][<span class="stringliteral">&#39;project_id&#39;</span>],</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="stringliteral">&#39;type_id&#39;</span> =&gt; <a class="code" href="cvterm__utils_8inc.html#a9c920f817e935cf101063a1645b73343">tpps_load_cvterm</a>(<span class="stringliteral">&#39;file_path&#39;</span>)-&gt;cvterm_id,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="stringliteral">&#39;value&#39;</span> =&gt; file_create_url($file-&gt;uri),</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="stringliteral">&#39;rank&#39;</span> =&gt; $state[<span class="stringliteral">&#39;file_rank&#39;</span>],</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    ));</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    $state[<span class="stringliteral">&#39;file_rank&#39;</span>]++;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7ee13a630c6758f97878467f7a2df479"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ee13a630c6758f97878467f7a2df479">&#9670;&nbsp;</a></span>tpps_chado_insert_multi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_chado_insert_multi </td>
          <td>(</td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$record_groups</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Inserts multiple records into the chado database.</p>
<p>This function will insert multiple records into multiple tables in the chado database. This function is much faster than the <a class="el" href="chado__utils_8inc.html#a97efcdeca8e6cb331a0434876881b713">tpps_chado_insert_record()</a> function with the 'multi' option set to true, because .</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$record_groups</td><td>An array of tables and the records that will be going into each table. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed An array of primary key ids on success. On failure, return FALSE. </dd></dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00141">141</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                                                                 {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (!isset($options[<span class="stringliteral">&#39;devel&#39;</span>])) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    $options[<span class="stringliteral">&#39;devel&#39;</span>] = FALSE;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// Initialize insert statements, schemas, foreign keys, and primary keys.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  $inserts = array();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  $schemas = array();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  $primarys = array();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  $fks = array();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">foreach</span> (array_keys($record_groups) as $table) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    $current_records = &amp;$record_groups[$table];</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">if</span> (empty($current_records)) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      unset($record_groups[$table]);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    $schemas[$table] = chado_get_schema($table);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (!$schemas[$table]) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;fk_overrides&#39;</span>][$table])) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">foreach</span> ($options[<span class="stringliteral">&#39;fk_overrides&#39;</span>][$table] as $fk_type =&gt; $props) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        $schemas[$table][<span class="stringliteral">&#39;foreign keys&#39;</span>][$fk_type] = $props;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    $inserts[$table] = db_insert(<span class="stringliteral">&quot;chado.$table&quot;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    $fields_arr = array();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">foreach</span> (current($current_records) as $field =&gt; $val) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">if</span> ($field != <span class="stringliteral">&#39;#fk&#39;</span>) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        $fields_arr[] = $field;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">foreach</span> ($val as $fk_type =&gt; $fk_val) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          $fields_arr[] = key($schemas[$table][<span class="stringliteral">&#39;foreign keys&#39;</span>][$fk_type][<span class="stringliteral">&#39;columns&#39;</span>]);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    $inserts[$table]-&gt;fields($fields_arr);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    $primarys[$table] = !empty($schemas[$table][<span class="stringliteral">&#39;primary key&#39;</span>][0]) ? $schemas[$table][<span class="stringliteral">&#39;primary key&#39;</span>][0] : NULL;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    $fks[$table] = array();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;devel&#39;</span>]) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    $start_time = microtime(TRUE);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    print_r(<span class="stringliteral">&quot;\nstart time: &quot;</span> . date(<span class="charliteral">&#39;r&#39;</span>) . <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    $times = array(</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="stringliteral">&#39;total&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="stringliteral">&#39;unique&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="stringliteral">&#39;unique_query&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="stringliteral">&#39;unique_other&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="stringliteral">&#39;insert&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="stringliteral">&#39;other&#39;</span> =&gt; 0,</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    );</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">foreach</span> ($record_groups as $table =&gt; $records) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    $schema = &amp;$schemas[$table];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    $primary = &amp;$primarys[$table];</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    $fks_to_populate = array();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    $has_fields = FALSE;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;devel&#39;</span>]) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      $start_unique = microtime(TRUE);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">foreach</span> ($records as $id =&gt; $values) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      $unique = !empty($schema[<span class="stringliteral">&#39;unique keys&#39;</span>]) ? $schema[<span class="stringliteral">&#39;unique keys&#39;</span>] : array();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">if</span> (!empty($values[$primary])) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        $unique[<span class="stringliteral">&#39;primary&#39;</span>] = array($primary);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      $exists = FALSE;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (!empty($values[<span class="stringliteral">&#39;#fk&#39;</span>])) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">foreach</span> ($values[<span class="stringliteral">&#39;#fk&#39;</span>] as $fk_type =&gt; $foreign_record_id) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          $fk_table = $schema[<span class="stringliteral">&#39;foreign keys&#39;</span>][$fk_type][<span class="stringliteral">&#39;table&#39;</span>];</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          $col_name = key($schema[<span class="stringliteral">&#39;foreign keys&#39;</span>][$fk_type][<span class="stringliteral">&#39;columns&#39;</span>]);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          $values[$col_name] = $fks[$fk_table][$foreign_record_id];</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        unset($values[<span class="stringliteral">&#39;#fk&#39;</span>]);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">foreach</span> ($unique as $fields) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        $u_cols = array(<span class="charliteral">&#39;*&#39;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        $u_vals = array();</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">foreach</span> ($fields as $field) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          <span class="keywordflow">if</span> (!array_key_exists($field, $values)) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;default&#39;</span>, $schema[<span class="stringliteral">&#39;fields&#39;</span>][$field])) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;              $u_vals[$field] = $schema[<span class="stringliteral">&#39;fields&#39;</span>][$field][<span class="stringliteral">&#39;default&#39;</span>];</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;          }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            $u_vals[$field] = $values[$field];</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        $start_query = microtime(TRUE);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        $results = chado_select_record($table, $u_cols, $u_vals);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;devel&#39;</span>]) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          $times[<span class="stringliteral">&#39;unique_query&#39;</span>] += (microtime(TRUE) - $start_query);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">if</span> ($results and isset($primary)) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;          $exists = TRUE;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          <span class="keywordflow">if</span> (count($results) == 1) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="keywordflow">if</span> (!empty($values[$primary])) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;              unset($values[$primary]);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">foreach</span> ($values as $field =&gt; $val) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;              <span class="keywordflow">if</span> ($val == current($results)-&gt;{$field}) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                unset($values[$field]);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;              }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">if</span> (!empty($values)) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;              $fks[$table][$id] = chado_update_record($table, $u_vals, $values, array(<span class="stringliteral">&#39;return_record&#39;</span> =&gt; TRUE))-&gt;{$primary};</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          $fks[$table][$id] = current($results)-&gt;{$primary};</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">if</span> (!$exists) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        $inserts[$table]-&gt;values($values);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        $has_fields = TRUE;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        $fks_to_populate[] = $id;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;devel&#39;</span>]) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      $times[<span class="stringliteral">&#39;unique&#39;</span>] += (microtime(TRUE) - $start_unique);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      $start_insert = microtime(TRUE);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> ($has_fields) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">if</span> ($table == <span class="stringliteral">&#39;featureloc&#39;</span>) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        $previous = chado_set_active(<span class="stringliteral">&#39;chado&#39;</span>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        $last_id = $inserts[$table]-&gt;execute();</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        chado_set_active($previous);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        $last_id = $inserts[$table]-&gt;execute();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      $fks[$table] += array_combine($fks_to_populate, range($last_id - count($fks_to_populate) + 1, $last_id));</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;devel&#39;</span>]) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      $times[<span class="stringliteral">&#39;insert&#39;</span>] += (microtime(TRUE) - $start_insert);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;devel&#39;</span>]) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    $times[<span class="stringliteral">&#39;total&#39;</span>] = microtime(TRUE) - $start_time;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    print_r(<span class="stringliteral">&quot;\nend time: &quot;</span> . date(<span class="charliteral">&#39;r&#39;</span>) . <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    $times[<span class="stringliteral">&#39;other&#39;</span>] = $times[<span class="stringliteral">&#39;total&#39;</span>] - $times[<span class="stringliteral">&#39;unique&#39;</span>] - $times[<span class="stringliteral">&#39;insert&#39;</span>];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    $times[<span class="stringliteral">&#39;unique_other&#39;</span>] = $times[<span class="stringliteral">&#39;unique&#39;</span>] - $times[<span class="stringliteral">&#39;unique_query&#39;</span>];</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    print_r(<span class="stringliteral">&quot;timing breakdown:\n&quot;</span>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    print_r($times);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;entities&#39;</span>])) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="chado__utils_8inc.html#a840bc175665125f5098ada021bda08cd">tpps_tripal_entity_publish</a>($options[<span class="stringliteral">&#39;entities&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>], ($fks[$options[<span class="stringliteral">&#39;entities&#39;</span>][<span class="stringliteral">&#39;table&#39;</span>]] ?? array()), array(</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="stringliteral">&#39;multi&#39;</span> =&gt; TRUE,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="stringliteral">&#39;prefix&#39;</span> =&gt; ($options[<span class="stringliteral">&#39;entities&#39;</span>][<span class="stringliteral">&#39;prefix&#39;</span>] ?? NULL),</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    ));</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;fks&#39;</span>])) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> $fks[$options[<span class="stringliteral">&#39;fks&#39;</span>]];</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">return</span> $fks;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a97efcdeca8e6cb331a0434876881b713"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97efcdeca8e6cb331a0434876881b713">&#9670;&nbsp;</a></span>tpps_chado_insert_record()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_chado_insert_record </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$records</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Inserts a record to a chado table using the Tripal Chado API.</p>
<p>This function uses the Tripal Chado API to insert a record. However, if the record already exists, then this function will update that record in the database instead. This function also supports insertion of multiple records at a time, while the standard Tripal chado_insert_record function does not.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$table</td><td>The name of the Chado table being inserted to. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$records</td><td>The record or array of records to be inserted to chado. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>An array of additional options which can be passed to chado_insert_record.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed The id of the new record in the database. False if insertion aborted. This is only supported for single record insertions </dd></dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00027">27</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                                                              {</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">if</span> (!array_key_exists(<span class="stringliteral">&#39;multi&#39;</span>, $options)) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    $options[<span class="stringliteral">&#39;multi&#39;</span>] = FALSE;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">if</span> (!$options[<span class="stringliteral">&#39;multi&#39;</span>]) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    $records = array($records);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  }</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    $has_fields = FALSE;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    $insert = db_insert(<span class="stringliteral">&quot;chado.$table&quot;</span>);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    $fields_arr = array();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">foreach</span> ($records[0] as $field =&gt; $val) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      $fields_arr[] = $field;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    $insert-&gt;fields($fields_arr);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  $table_desc = chado_get_schema($table);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">if</span> (!$table_desc) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  $primary = !empty($table_desc[<span class="stringliteral">&#39;primary key&#39;</span>][0]) ? $table_desc[<span class="stringliteral">&#39;primary key&#39;</span>][0] : NULL;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">foreach</span> ($records as $values) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Populate insert_values array and check if a record with the same unique</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// fields already exists. If it does, return the existing primary key.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    $insert_values = array();</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">foreach</span> ($values as $field =&gt; $value) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="keywordflow">if</span> (is_array($value)) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        $results = chado_schema_get_foreign_key($table_desc, $field, $value);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">if</span> (count($results) != 1) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;          <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;          $insert_values[$field] = $results[0];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        $insert_values[$field] = $value;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    $unique = array();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;unique keys&#39;</span>, $table_desc)) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      $unique = $table_desc[<span class="stringliteral">&#39;unique keys&#39;</span>];</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    $unique[<span class="stringliteral">&#39;primary&#39;</span>] = array($primary);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    $exists = FALSE;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">foreach</span> ($unique as $name =&gt; $fields) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      $u_cols = array($primary);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      $u_vals = array();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">foreach</span> ($fields as $index =&gt; $field) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        $u_cols[] = $field;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (!array_key_exists($field, $insert_values)) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;          <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;default&#39;</span>, $table_desc[<span class="stringliteral">&#39;fields&#39;</span>][$field])) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            $u_vals[$field] = $table_desc[<span class="stringliteral">&#39;fields&#39;</span>][$field][<span class="stringliteral">&#39;default&#39;</span>];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          $u_vals[$field] = $insert_values[$field];</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">if</span> (!empty($u_vals) and ($results = chado_select_record($table, $u_cols, $u_vals))) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        $exists = TRUE;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">// If the new values match with exactly one record, update that one</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment">// and return the primary key.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> (!$options[<span class="stringliteral">&#39;multi&#39;</span>] and count($results) == 1) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          chado_update_record($table, $u_vals, $insert_values);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;          <span class="keywordflow">return</span> $results[0]-&gt;{$primary};</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (!$exists and $options[<span class="stringliteral">&#39;multi&#39;</span>]) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      $insert-&gt;values($insert_values);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      $has_fields = TRUE;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> (!$options[<span class="stringliteral">&#39;multi&#39;</span>]) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">if</span> ($exists) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">return</span> $results[0]-&gt;{$primary};</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      $new_record = chado_insert_record($table, $insert_values, $options);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">if</span> (!empty($new_record[$primary])) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">return</span> $new_record[$primary];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;multi&#39;</span>] and $has_fields) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    $insert-&gt;execute();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6d1ac62713fda5ab9ae6b4fab2637498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d1ac62713fda5ab9ae6b4fab2637498">&#9670;&nbsp;</a></span>tpps_chado_prop_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_chado_prop_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$base_table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks to see if a property of an item already exists in chado.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$base_table</td><td>The name of the base chado table. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>The record if of the base item. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$name</td><td>The name of the type_id of the property we are looking for. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool TRUE if a property exists, otherwise FALSE. </dd></dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00424">424</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  $prop_table = $base_table . <span class="stringliteral">&#39;prop&#39;</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  $cvterm = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;prop_table&#39;</span>, $options)) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    $prop_table = $options[<span class="stringliteral">&#39;prop_table&#39;</span>];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;cv&#39;</span>, $options)) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    $cvterm[<span class="stringliteral">&#39;cv_id&#39;</span>] = array(</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="stringliteral">&#39;name&#39;</span> =&gt; $options[<span class="stringliteral">&#39;cv&#39;</span>],</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    );</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  $prop_query = chado_select_record($prop_table, array($prop_table . <span class="stringliteral">&#39;_id&#39;</span>), array(</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="stringliteral">&#39;type_id&#39;</span> =&gt; $cvterm,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    $base_table . <span class="stringliteral">&#39;_id&#39;</span> =&gt; $id,</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  ));</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">return</span> !empty($prop_query);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a32510acf7177b9adcb53575b09b1749a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32510acf7177b9adcb53575b09b1749a">&#9670;&nbsp;</a></span>tpps_get_taxon()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_get_taxon </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$org_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rank</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tries to retrieve taxonomy information about an organism from the db.</p>
<p>If taxonomy information for the genus does not already exist, then the function tries to retrieve taxonomy information from NCBI.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$org_name</td><td>The full name (genus, species) of the organism. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$rank</td><td>The taxonomic rank (subkingdom, order, family, etc).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The the taxonomy information of the organism. </dd></dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00487">487</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                          {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  $parts = explode(<span class="charliteral">&#39; &#39;</span>, $org_name);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  $genus = $parts[0];</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  $query = db_select(<span class="stringliteral">&#39;chado.organismprop&#39;</span>, <span class="stringliteral">&#39;op&#39;</span>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  $query-&gt;join(<span class="stringliteral">&#39;chado.organism&#39;</span>, <span class="charliteral">&#39;o&#39;</span>, <span class="stringliteral">&#39;o.organism_id = op.organism_id&#39;</span>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  $query-&gt;fields(<span class="stringliteral">&#39;op&#39;</span>, array(<span class="stringliteral">&#39;value&#39;</span>));</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  $query-&gt;condition(<span class="stringliteral">&#39;op.type_id&#39;</span>, <a class="code" href="cvterm__utils_8inc.html#a9c920f817e935cf101063a1645b73343">tpps_load_cvterm</a>($rank)-&gt;cvterm_id);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  $query-&gt;condition(<span class="stringliteral">&#39;o.genus&#39;</span>, $genus);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  $query-&gt;range(0, 1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  $query = $query-&gt;execute();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  $result = $query-&gt;fetchObject()-&gt;value ?? NULL;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">if</span> (!empty($result)) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">return</span> $result;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="ncbi__utils_8inc.html#af6b941b9437cd90f284a85ae2c96d5b0">tpps_ncbi_get_taxonomy</a>($org_name, $rank);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a68e5adbe9c2c69f23984f87909fe08b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68e5adbe9c2c69f23984f87909fe08b1">&#9670;&nbsp;</a></span>tpps_table_columns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_table_columns </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns an array of field names associated with a db table.</p>
<p>This function first checks the chado schema of the table. If there is no existing chado schema, then it will check the drupal schema. If there is no existing drupal schema, it will return an empty array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$table</td><td>The name of the table.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array An array of field names. </dd></dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00458">458</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                    {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  $schema = chado_get_schema($table);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span> (empty($schema)) {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    $schema = drupal_get_schema($table);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (empty($schema)) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">return</span> array();</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  $cols = array();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">foreach</span> ($schema[<span class="stringliteral">&#39;fields&#39;</span>] as $name =&gt; $info) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    $cols[] = $name;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">return</span> $cols;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a840bc175665125f5098ada021bda08cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840bc175665125f5098ada021bda08cd">&#9670;&nbsp;</a></span>tpps_tripal_entity_publish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpps_tripal_entity_publish </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$bundle_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$vals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Publish a Tripal Entity based on the bundle name, title, and record id.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$bundle_name</td><td>The name of the bundle, for example, "Organism", "Gene", "Project", etc. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$vals</td><td>The an array of entity values to be published. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Additional options for publishing. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="chado__utils_8inc_source.html#l00327">327</a> of file <a class="el" href="chado__utils_8inc_source.html">chado_utils.inc</a>.</p>
<div class="fragment"><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                                                                         {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;multi&#39;</span>])) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    $bundle = tripal_load_bundle_entity(array(<span class="stringliteral">&#39;label&#39;</span> =&gt; $bundle_name));</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (!isset($bundle)) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    $time = time();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    $entity_insert = db_insert(<span class="stringliteral">&#39;tripal_entity&#39;</span>)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      -&gt;fields(array(<span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;bundle&#39;</span>, <span class="stringliteral">&#39;term_id&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;created&#39;</span>, <span class="stringliteral">&#39;changed&#39;</span>));</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    $entity_count = 0;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">foreach</span> ($vals as $title =&gt; $id) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">if</span> (empty(chado_get_record_entity_by_bundle($bundle, $id))) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">if</span> (!empty($options[<span class="stringliteral">&#39;prefix&#39;</span>])) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          $title = $options[<span class="stringliteral">&#39;prefix&#39;</span>] . $title;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        $entity_insert-&gt;values(array(</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;TripalEntity&#39;</span>,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          <span class="stringliteral">&#39;bundle&#39;</span> =&gt; <span class="stringliteral">&#39;bio_data_&#39;</span> . $bundle-&gt;id,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          <span class="stringliteral">&#39;term_id&#39;</span> =&gt; $bundle-&gt;term_id,</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          <span class="stringliteral">&#39;title&#39;</span> =&gt; $title,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          <span class="stringliteral">&#39;created&#39;</span> =&gt; $time,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <span class="stringliteral">&#39;changed&#39;</span> =&gt; $time,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        ));</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        $entity_count++;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    $entity_id = $entity_insert-&gt;execute() - $entity_count + 1;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    $bio_data_insert = db_insert(<span class="stringliteral">&#39;chado_bio_data_&#39;</span> . $bundle-&gt;id)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      -&gt;fields(array(<span class="stringliteral">&#39;entity_id&#39;</span>, <span class="stringliteral">&#39;record_id&#39;</span>));</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">foreach</span> ($vals as $id) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">if</span> (empty(chado_get_record_entity_by_bundle($bundle, $id))) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        $bio_data_insert-&gt;values(array(</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          <span class="stringliteral">&#39;entity_id&#39;</span> =&gt; $entity_id,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          <span class="stringliteral">&#39;record_id&#39;</span> =&gt; $id,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        ));</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        $entity = tripal_load_entity(<span class="stringliteral">&#39;TripalEntity&#39;</span>, array($entity_id))[$entity_id];</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        $controller = entity_get_controller(<span class="stringliteral">&#39;TripalEntity&#39;</span>);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        $controller-&gt;setAlias($entity);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        $controller-&gt;resetCache();</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        $entity_id++;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    $bio_data_insert-&gt;execute();</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    $bundle = tripal_load_bundle_entity(array(<span class="stringliteral">&#39;label&#39;</span> =&gt; $bundle_name));</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (!isset($bundle)) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (empty(chado_get_record_entity_by_bundle($bundle, $vals[1]))) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      $entity_id = db_insert(<span class="stringliteral">&#39;tripal_entity&#39;</span>)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        -&gt;fields(array(</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;          <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;TripalEntity&#39;</span>,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          <span class="stringliteral">&#39;bundle&#39;</span> =&gt; <span class="stringliteral">&#39;bio_data_&#39;</span> . $bundle-&gt;id,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          <span class="stringliteral">&#39;term_id&#39;</span> =&gt; $bundle-&gt;term_id,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <span class="stringliteral">&#39;title&#39;</span> =&gt; $vals[0],</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <span class="stringliteral">&#39;created&#39;</span> =&gt; time(),</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          <span class="stringliteral">&#39;changed&#39;</span> =&gt; time(),</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        ))</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        -&gt;execute();</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      db_insert(<span class="stringliteral">&#39;chado_bio_data_&#39;</span> . $bundle-&gt;id)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        -&gt;fields(array(</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="stringliteral">&#39;entity_id&#39;</span> =&gt; $entity_id,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="stringliteral">&#39;record_id&#39;</span> =&gt; $vals[1],</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        ))</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        -&gt;execute();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      $entity = tripal_load_entity(<span class="stringliteral">&#39;TripalEntity&#39;</span>, array($entity_id))[$entity_id];</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      $controller = entity_get_controller(<span class="stringliteral">&#39;TripalEntity&#39;</span>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      $controller-&gt;setAlias($entity);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      $controller-&gt;resetCache();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="achado__utils_8inc_html_a97efcdeca8e6cb331a0434876881b713"><div class="ttname"><a href="chado__utils_8inc.html#a97efcdeca8e6cb331a0434876881b713">tpps_chado_insert_record</a></div><div class="ttdeci">tpps_chado_insert_record($table, $records, array $options=array())</div><div class="ttdef"><b>Definition:</b> <a href="chado__utils_8inc_source.html#l00027">chado_utils.inc:27</a></div></div>
<div class="ttc" id="achado__utils_8inc_html_a840bc175665125f5098ada021bda08cd"><div class="ttname"><a href="chado__utils_8inc.html#a840bc175665125f5098ada021bda08cd">tpps_tripal_entity_publish</a></div><div class="ttdeci">tpps_tripal_entity_publish($bundle_name, array $vals, array $options=array())</div><div class="ttdef"><b>Definition:</b> <a href="chado__utils_8inc_source.html#l00327">chado_utils.inc:327</a></div></div>
<div class="ttc" id="acvterm__utils_8inc_html_a9c920f817e935cf101063a1645b73343"><div class="ttname"><a href="cvterm__utils_8inc.html#a9c920f817e935cf101063a1645b73343">tpps_load_cvterm</a></div><div class="ttdeci">tpps_load_cvterm($term, array $options=array(), $version=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="cvterm__utils_8inc_source.html#l00194">cvterm_utils.inc:194</a></div></div>
<div class="ttc" id="ancbi__utils_8inc_html_af6b941b9437cd90f284a85ae2c96d5b0"><div class="ttname"><a href="ncbi__utils_8inc.html#af6b941b9437cd90f284a85ae2c96d5b0">tpps_ncbi_get_taxonomy</a></div><div class="ttdeci">tpps_ncbi_get_taxonomy($organism, $rank)</div><div class="ttdef"><b>Definition:</b> <a href="ncbi__utils_8inc_source.html#l00019">ncbi_utils.inc:19</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_09e761304027c904456130627fd4dcf5.html">includes</a></li><li class="navelem"><a class="el" href="chado__utils_8inc.html">chado_utils.inc</a></li>
    <li class="footer">Generated on Fri Aug 21 2020 13:58:20 for Tripal Plant PopGen Submit by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
