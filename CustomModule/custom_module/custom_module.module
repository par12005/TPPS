<?php

//hook_init
function custom_module_init() {

//    drupal_set_message("Hello");
}

function custom_module_menu() {

    $items = array();

    $items['Hellopage'] = array(
      'title' => 'TPPS Development',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('custom_module_showCustomModuleForm'),
      'access callback' => 'user_access',
      'access arguments' => array('access content'),
      'type' => MENU_NORMAL_ITEM
    );

    $items['secondPage'] = array(
      'title' => 'TPPS Development',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('custom_module_showCustomModuleForm_second_page'),
      'access callback' => 'user_access',
      'access arguments' => array('access content'),
      'type' => MENU_NORMAL_ITEM
    );
    
    $items['thirdPage'] = array(
      'title' => 'TPPS Development',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('custom_module_showCustomModuleForm_third_page'),
      'access callback' => 'user_access',
      'access arguments' => array('access content'),
      'type' => MENU_NORMAL_ITEM
    );

    $items['getHello'] = array(
      'page callback' => 'custom_module_ajaxCallHandler',
      'access callback' => 'user_access',
      'access arguments' => array('access content'),
      'type' => MENU_CALLBACK
    );
    
    $items['structure/autocomplete'] = array(
      'title' => 'Autocomplete for Ontological terms',
      'page callback' => '_structure_autocomplete',
      'access arguments' => array('access content'),
      'type' => MENU_CALLBACK
    );
    
    $items['developmental/autocomplete'] = array(
      'title' => 'Autocomplete for Ontological terms',
      'page callback' => '_development_autocomplete',
      'access arguments' => array('access content'),
      'type' => MENU_CALLBACK
    );

    return $items;
}

function custom_module_ajaxCallHandler() {

    global $user;

    if (empty($_GET['token']) || !drupal_valid_token($_GET['token'], 'my secret value' . $user->uid)) {
        return MENU_ACCESS_DENIED;
    }

    echo "Hello, " . filter_xss($_GET['name']) . "!";
}

function custom_module_showCustomModuleForm() {

    $authorArr = array();
    $authorResults = db_query('SELECT contact.contact_id, contact.name FROM chado.contact WHERE contact.type_id = 71 ORDER BY contact.name LIMIT 200');

    foreach ($authorResults as $r) {
        $authorArr[$r->contact_id] = $r->name;
    }

    $form['primaryAuthor'] = array(
      '#prefix' => '<div id=primaryauthor>',
      '#suffix' => '</div>',
      '#type' => 'select',
      '#title' => t('Primary Author'),
      '#options' => $authorArr,
      '#required' => true,
      '#default_value' => 0,
    );

    $form['#suffix'] = '<input type="button" id="button" value="Add Author"><br/><div></div>';

    for ($i = 0; $i < 30; $i++) {
        if ($i == 0) {
            $form['secondaryAuthorForm' . $i] = array(
              '#prefix' => '<div id= secondaryAuthor' . $i . '>',
              '#type' => 'select',
              '#options' => array_merge(array(0 => 'Other'), $authorArr),
            );

            $form['secondaryAuthorCustomForm' . $i] = array(
              '#suffix' => '</div>',
              '#type' => 'textfield',
            );
        }
        else {
            $form['secondaryAuthorForm' . $i] = array(
              '#prefix' => '<div id= secondaryAuthor' . $i . '>',
              '#type' => 'select',
              '#options' => array_merge(array(0 => 'Other'), $authorArr),
            );

            $form['secondaryAuthorCustomForm' . $i] = array(
              '#suffix' => '</div>',
              '#type' => 'textfield',
            );
        }
    }

    $organizationArr = array();
    $organizationResults = db_query('SELECT contact.contact_id, contact.name FROM chado.contact WHERE contact.type_id = 72 ORDER BY contact.name LIMIT 200');

    foreach ($organizationResults as $r) {
        $organizationArr[$r->contact_id] = $r->name;
    }

    $form['organization'] = array(
      '#type' => 'select',
      '#title' => t('Organization'),
      '#options' => $organizationArr,
      '#required' => true,
    );

    $form['publicationStatus'] = array(
      '#type' => 'select',
      '#title' => t('Publication Status'),
      '#options' => array(
        0 => t('--Publication Status--'),
        1 => t('In Preparation'),
        2 => t('Submitted'),
        3 => t('In press'),
        4 => t('Published'),
      ),
      '#required' => true,
    );

    $yearArr = Array();
    for ($i = 1950; $i <= 2017; $i++) {
        array_push($yearArr, $i);
    }

    $form['year'] = array(
      '#type' => 'select',
      '#title' => t('Year'),
      '#options' => $yearArr,
      '#required' => true,
    );

    $form['title'] = array(
      '#type' => 'textfield',
      '#title' => t('Title'),
      '#required' => true,
    );

    $form['abstract'] = array(
      '#type' => 'textfield',
      '#title' => t('Abstract'),
      '#required' => true,
    );

    $journalArr = Array();
    $journalResults = db_query('SELECT DISTINCT series_name FROM chado.pub ORDER BY series_name LIMIT 200');

    foreach ($journalResults as $r) {
        array_push($journalArr, $r->series_name);
    }

    $form['journal'] = array(
      '#type' => 'select',
      '#title' => t('Journal'),
      '#options' => $journalArr,
      '#default_value' => 1,
    );

    $speciesNumberRange = range(0, 15);

    $form['speciesNumber'] = array(
      '#type' => 'select',
      '#title' => t('Please Select the Number of Species under Study'),
      '#options' => $speciesNumberRange,
      '#default_value' => 0,
    );

    $genusResult = db_query('SELECT DISTINCT genus FROM chado.organism ORDER BY genus LIMIT 200');
    $genusArr = Array();

    foreach ($genusResult as $r) {
        $genusArr[] = $r->genus;
    }

    $speciesResult = db_query('SELECT DISTINCT organism_id, species FROM chado.organism ORDER BY species LIMIT 200');
    $speciesArr = array();

    foreach ($speciesResult as $r) {
        $speciesArr[$r->organism_id] = $r->species;
    }

    for ($i = 0; $i < 15; $i++) {
        if ($i == 0) {
            $form['genus' . $i] = array(
              '#prefix' => '<div id= genusSpecies' . $i . '>',
              '#title' => t('Genus'),
              '#type' => 'select',
              '#options' => $genusArr,
            );

            $form['species' . $i] = array(
              '#type' => 'select',
              '#title' => t('Species'),
              '#options' => array_merge(array(0 => 'Other'), $speciesArr),
            );

            $form['customSpecies' . $i] = array(
              '#suffix' => '</div>',
              '#type' => 'textfield',
            );
        }
        else {
            $form['genus' . $i] = array(
              '#prefix' => '<div id= genusSpecies' . $i . '>',
              '#title' => t('Genus'),
              '#type' => 'select',
              '#options' => $genusArr,
            );
            $form['species' . $i] = array(
              '#type' => 'select',
              '#title' => t('Species'),
              '#options' => array_merge(array(0 => 'Other'), $speciesArr),
            );
        }
        $form['customSpecies' . $i] = array(
          '#suffix' => '</div>',
          '#type' => 'textfield',
        );
    }

    $form['keywords'] = array(
      '#type' => 'textfield',
      '#title' => t('Keywords'),
      '#description' => t('Please enter keywords separated by commmas'),
      '#required' => true,
    );

    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => t('Submit'),
    );


    /* This is the convention for adding JS files to your form.
     * Since it is added directly to the form, I would imagine 
     * it is only accessible to this specific form.  
     */
    drupal_add_js(drupal_get_path('module', 'custom_module') . "/custom_module.js");

    /*
     * This is instantiating a user token.  It will be verified
     * in the JS file and they will not be given acess to data 
     * returned by AJAX if their token is invalid (if not logged
     * in).
     */
    global $user;
    $newToken = drupal_get_token("my secret value" . $user->uid);
    drupal_add_js("var myToken='$newToken'", "inline");

    return $form;
}

function custom_module_showCustomModuleForm_validate($form, &$form_state) {

}

function custom_module_showCustomModuleForm_submit($form, &$form_state) {
//    Values in the fields need to be submitted to a junk table in chado schema
//    $form_state['values'] for secondary author textfield is blank?
    $primaryAuthor = $form_state['values']['primaryAuthor'];
    $orginization = $form_state['values']['organization'];
    $publicationStatus = $form_state['values']['publicationStatus'];
    $journal = $form_state['values']['journal'];
    $title = $form_state['values']['title'];
    $year = $form_state['values']['year'];
    $abstract = $form_state['values']['abstract'];
    
    $submitArr = array($primaryAuthor, $orginization, $publicationStatus, $journal, $title, $year, $abstract);
    for ($i = 0; $i <= 10; $i++){
        if ($form_state['values']['secondaryAuthorForm' . $i] == 'Other'){
//            send $form_state['values']['secondaryAuthorCustomForm' . $i] to temporary table
        }
        
        else{
//            send $form_state['values']['secondaryAuthorForm' . $i] to temporary table
        }
        
        if ($form_state['values']['species' . $i] == 'Other'){
//            send $form_state['values']['customSpecies' . $i] to temporary table            
        }
        
        else{
//            send $form_state['values']['species' . $i] to temporary table
        }
    }

//     foreach($submitArr as $r) {
//        db_query('INSERT INTO chado.custom_table_version 2 (custom_field) '
//            . 'VALUES (' . $r 
//            . ' )');
//    }
//    
//     $authorResults = db_query('SELECT contact.contact_id, contact.name FROM chado.contact WHERE contact.type_id = 71 ORDER BY contact.name LIMIT 200');
//    
//    
//    
//    $rawKeywords = $form_state['values']['keywords']; 
//    $keyWords = explode(',', $rawKeywords);      
    
//    $secondaryAuthorArr = array();
//    
//    }
    

    $form_state['redirect'] = 'secondPage';
 
}

function custom_module_showCustomModuleForm_second_page() {
    
    function studyDate($type, &$form){
        
        $form[$type . 'Date'] = array(
          '#prefix' => '<div class="container-inline">', 
          '#type' => 'fieldset',
          '#title' => t($type . ' Date'),
          '#tree' => TRUE,
        );
        
        $yearArr = array();
        $yearArr[0] = '-Select-';
        for ($i = 1950; $i <= 2017; $i++) {
            $index = $i - 1949;
            $yearArr[$index] = $i;
        }
        

        $form[$type . 'Date']['year'] = array(
          '#type' => 'select',
          '#title' => t('Year'),
          '#options' => $yearArr,
          '#default_value' => 0,
          '#required' => true,
        );
        
        $form[$type . 'Date']['month'] = array(
          '#type' => 'select',
          '#title' => t('Month'),
          '#options' => array(
            0 => '-Select-',
            1 => 'January',
            2 => 'February',
            3 => 'March',
            4 => 'April',
            5 => 'May',
            6 => 'June',
            7 => 'July',
            8 => 'August',
            9 => 'September',
            10 => 'October',
            11 => 'November',
            12 => 'December'
          ),
          '#default_value' => 0,
          '#required' => true,
          '#states' => array(
            'invisible' => array(
              ':input[name="' . $type . 'Date[year]"]' => array('value' => '0')
            )
          )
        );
        
        $dayArr31 = Array();
        for ($i = 1; $i <= 31; $i++) {
            array_push($dayArr31, $i);
        }
        
        $dayArr30 = Array();
        for ($i = 1; $i <= 30; $i++) {
            array_push($dayArr30, $i);
        }
        
        $dayArr29 = Array();
        for ($i = 1; $i <= 29; $i++) {
            array_push($dayArr29, $i);
        }

        $form[$type . 'Date']['day31'] = array(
          '#type' => 'select',
          '#options' => array_merge(array('-Select-'), $dayArr31),
          '#title' => t('Day'),
          '#states' => array(
            'visible' => array(
              array(
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '1')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '3')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '5')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '7')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '8')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '10')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '12')),
              )
            ),
            'required' => array(
              array(
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '1')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '3')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '5')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '7')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '8')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '10')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '12')),
              )
            ),
          )
        );
        
        $form[$type . 'Date']['day30'] = array(
          '#type' => 'select',
          '#options' => array_merge(array('-Select-'), $dayArr30),
          '#title' => t('Day'),
          '#states' => array(
            'visible' => array(
              array(
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '4')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '6')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '9')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '11')),
              )
            ),
            'required' => array(
              array(
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '4')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '6')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '9')),
                'or',
                array(':input[name="' . $type . 'Date[month]"]' => array('value' => '11')),
              )
            ),
          )
        );
        
        $form[$type . 'Date']['day29'] = array(
          '#type' => 'select',
          '#options' => array_merge(array('-Select-'), $dayArr29),
          '#title' => t('Day'),
          '#states' => array(
            'visible' => array(
              ':input[name="' . $type . 'Date[month]"]' => array('value' => '2')
            ),
            'required' => array(
              ':input[name="' . $type . 'Date[month]"]' => array('value' => '2')
            )
          ),
          '#suffix' => '</div>'
        );
        
        return $form;
    }
    
    function studyLocation(&$form){
        
        $form['studyLocation'] = array(
          '#type' => 'fieldset',
          '#title' => t('Study Location:'),
          '#tree' => TRUE,
        );
        
        $form['studyLocation']['type'] = array(
          '#type' => 'select',
          '#title' => t('Location Format:'),
          '#options' => array(
            0 => 'Please select a location type',
            1 => 'Latitude/Longitude',
            2 => 'Custom Location'
          ),
          '#default_value' => 0,
          '#required' => TRUE
        );

        $form['studyLocation']['latitude'] = array(
          '#type' => 'textfield',
          '#title' => t('Latitude'),
          '#states' => array(
            'visible' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '1')
            ),
            'required' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '1')
            ),
            'disabled' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '2')
            )
          ),
        );

        $form['studyLocation']['longitude'] = array(
          '#type' => 'textfield',
          '#title' => t('Longitude'),
          '#states' => array(
            'visible' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '1')
            ),
            'required' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '1')
            ),
            'disabled' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '2')
            )
          ),
        );

        $form['studyLocation']['customLocation'] = array(
          '#type' => 'textfield',
          '#title' => t('Enter a custom location'),
          '#states' => array(
            'visible' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '2')
            ),
            'required' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '2')
            ),
            'disabled' => array(
              ':input[name="studyLocation[type]"]' => array('value' => '1')
            )
          ),
        );
        
        return $form;
    }
    
    function naturalPopulation(&$form){
        
        $form['naturalPopulation']['season'] = array(
          '#type' => 'select',
          '#title' => t('Season:'),
          '#options' => array(
            0 => 'Please select a season',
            1 => 'Spring',
            2 => 'Summer',
            3 => 'Fall',
            4 => 'Winter',
          ),
          '#default_value' => 0,
        );
        
        $form['naturalPopulation']['assessions'] = array(
          '#type' => 'textfield',
          '#title' => t('Number of times the populations were assessed (on average):')
        );
        
        return $form;
    }
    
    function growthChamber(&$form){
        
        function co2(&$form){
            
            $form['growthChamber']['co2Control'] = array(
              '#type' => 'fieldset',
              '#tree' => true
            );

            $form['growthChamber']['co2Control']['option'] = array(
              '#type' => 'select',
              '#title' => t('CO2 controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select CO2 control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '2')
                )
              )
            );

            $form['growthChamber']['co2Control']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled CO2 Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[co2Control][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="growthChamber[co2Control][option]"]' => array('value' => '1')
                )
              )
            );

            $form['growthChamber']['co2Control']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average CO2 Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[co2Control][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="growthChamber[co2Control][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        function humidity(&$form){
            
            $form['growthChamber']['humidityControl'] = array(
              '#type' => 'fieldset',
              '#tree' => true,
            );

            $form['growthChamber']['humidityControl']['option'] = array(
              '#type' => 'select',
              '#title' => t('Air Humidity controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select air humidity control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '2')
                )
              )
            );

            $form['growthChamber']['humidityControl']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled Air Humidity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[humidityControl][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="growthChamber[humidityControl][option]"]' => array('value' => '1')
                )
              )
            );

            $form['growthChamber']['humidityControl']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average Air Humidity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[humidityControl][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="growthChamber[humidityControl][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        function light(&$form){
            
            $form['growthChamber']['lightControl'] = array(
              '#type' => 'fieldset',
              '#tree' => true,
            );

            $form['growthChamber']['lightControl']['option'] = array(
              '#type' => 'select',
              '#title' => t('Light Intensity controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select Light Intensity control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '2')
                )
              )
            );

            $form['growthChamber']['lightControl']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled Light Intensity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[lightControl][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="growthChamber[lightControl][option]"]' => array('value' => '1')
                )
              )
            );

            $form['growthChamber']['lightControl']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average Light Intensity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[lightControl][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="growthChamber[lightControl][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        function ph(&$form){
            
            $form['growthChamber']['rooting']['ph'] = array(
              '#type' => 'fieldset',
              '#tree' => true
            );

            $form['growthChamber']['rooting']['ph']['option'] = array(
              '#type' => 'select',
              '#title' => t('pH controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select pH control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '2')
                )
              )
            );

            $form['growthChamber']['rooting']['ph']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled pH Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[rooting][ph][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="growthChamber[rooting][ph][option]"]' => array('value' => '1')
                )
              )
            );

            $form['growthChamber']['rooting']['ph']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average pH Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[rooting][ph][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="growthChamber[rooting][ph][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        co2($form);
        
        humidity($form);
        
        light($form);
        

        $form['growthChamber']['temp'] = array(
          '#type' => 'fieldset',
          '#title' => t('Temperature Information:'),
          '#description' => t('Please provide temperatures in Degrees Celsius'),
          '#tree' => true,
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '2')
            )
          )
        );

        $form['growthChamber']['temp']['day'] = array(
          '#type' => 'textfield',
          '#title' => t('Average Day Temperature'),
        );

        $form['growthChamber']['temp']['night'] = array(
          '#type' => 'textfield',
          '#title' => t('Average Night Temperature'),
        );

        $form['growthChamber']['temp']['range'] = array(
          '#type' => 'textfield',
          '#title' => t('Temperature Range'),
        );
        
        $form['growthChamber']['rooting'] = array(
          '#type' => 'fieldset',
          '#title' => t('Rooting Information:'),
          '#tree' => true,
        );
        
        $form['growthChamber']['rooting']['option'] = array(
          '#type' => 'select',
          '#title' => t('Rooting Type:'),
          '#options' => array(
            0 => 'Please select a rooting type',
            1 => 'Aeroponics',
            2 => 'Hydroponics',
            3 => 'Soil',
          ),
          '#default_value' => 0,
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '2')
            )
          )
        );
        
        $form['growthChamber']['rooting']['soil'] = array(
          '#type' => 'fieldset',
          '#title' => t('Soil Information:'),
          '#states' => array(
            'visible' => array(
              ':input[name="growthChamber[rooting][option]"]' => array('value' => '3')
            )
          )
        );
        
        $form['growthChamber']['rooting']['soil']['type'] = array(
          '#type' => 'select',
          '#title' => t('Soil Type:'),
          '#options' => array(
            0 => 'Please select a soil type',
            1 => 'Sand',
            2 => 'Peat',
            3 => 'Clay',
            4 => 'Mixed',
            5 => 'Other'
          ),
          '#states' => array(
            'required' => array(
              ':input[name="growthChamber[rooting][option]"]' => array('value' => '3')
            )
          )
        );
        
        $form['growthChamber']['rooting']['soil']['other'] = array(
          '#type' => 'textfield',
          '#states' => array(
            'visible' => array(
              ':input[name="growthChamber[rooting][soil][type]"]' => array('value' => '5')
            ),
            'required' => array(
              ':input[name="growthChamber[rooting][soil][type]"]' => array('value' => '5')
            )
          )
        );
        
        $form['growthChamber']['rooting']['soil']['container'] = array(
          '#type' => 'textfield',
          '#title' => t('Soil Container Type:'),
          '#states' => array (
            'required' => array(
              ':input[name="growthChamber[rooting][option]"]' => array('value' => '3')
            )
          )
        );
        
        ph($form);
        
        $treatment_options = drupal_map_assoc(array(
            t('Seasonal Environment'),
            t('Air temperature regime'),
            t('Soil Temperature regime'),
            t('Antibiotic regime'),
            t('Chemical administration'),
            t('Disease status'),
            t('Fertilizer regime'),
            t('Fungicide regime'),
            t('Gaseous regime'),
            t('Gravity Growth hormone regime'),
            t('Mechanical treatment'),
            t('Mineral nutrient regime'),
            t('Humidity regime'),
            t('Non-mineral nutrient regime'),
            t('Radiation (light, UV-B, X-ray) regime'),
            t('Rainfall regime'),
            t('Salt regime'),
            t('Watering regime'),
            t('Water temperature regime'),
            t('Pesticide regime'),
            t('pH regime'),
            t('other perturbation'),
          ));
        
        $form['growthChamber']['rooting']['treatment'] = array(
          '#type' => 'fieldset',
          '#title' => t('Rooting Treatments:'),
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '2')
            )
          )
        );
        
        foreach($treatment_options as $key => $option){
            $form['growthChamber']['rooting']['treatment']["$option"] = array(
              '#type' => 'checkbox',
              '#title' => t("$option")
            );
            $form['growthChamber']['rooting']['treatment']["$option-description"] = array(
              '#type' => 'textfield',
              '#description' => t("$option Description"),
              '#states' => array(
                'visible' => array(
                  ':input[name="growthChamber[rooting][treatment][' . $option . ']"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="growthChamber[rooting][treatment][' . $option . ']"]' => array('checked' => TRUE)
                )
              )
            );
        }
        
        return $form;
    }
    
    function greenhouse(&$form){
        
        function greenco2(&$form){
            
            $form['greenhouse']['co2Control'] = array(
              '#type' => 'fieldset',
              '#tree' => true
            );

            $form['greenhouse']['co2Control']['option'] = array(
              '#type' => 'select',
              '#title' => t('CO2 controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select CO2 control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '3')
                )
              )
            );

            $form['greenhouse']['co2Control']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled CO2 Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[co2Control][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="greenhouse[co2Control][option]"]' => array('value' => '1')
                )
              )
            );

            $form['greenhouse']['co2Control']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average CO2 Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[co2Control][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="greenhouse[co2Control][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        function greenhumidity(&$form){
            
            $form['greenhouse']['humidityControl'] = array(
              '#type' => 'fieldset',
              '#tree' => true,
            );

            $form['greenhouse']['humidityControl']['option'] = array(
              '#type' => 'select',
              '#title' => t('Air Humidity controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select air humidity control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '3')
                )
              )
            );

            $form['greenhouse']['humidityControl']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled Air Humidity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[humidityControl][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="greenhouse[humidityControl][option]"]' => array('value' => '1')
                )
              )
            );

            $form['greenhouse']['humidityControl']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average Air Humidity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[humidityControl][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="greenhouse[humidityControl][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        function greenlight(&$form){
            
            $form['greenhouse']['lightControl'] = array(
              '#type' => 'fieldset',
              '#tree' => true,
            );

            $form['greenhouse']['lightControl']['option'] = array(
              '#type' => 'select',
              '#title' => t('Light Intensity controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select Light Intensity control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '3')
                )
              )
            );

            $form['greenhouse']['lightControl']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled Light Intensity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[lightControl][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="greenhouse[lightControl][option]"]' => array('value' => '1')
                )
              )
            );

            $form['greenhouse']['lightControl']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average Light Intensity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[lightControl][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="greenhouse[lightControl][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        function greenph(&$form){
            
            $form['greenhouse']['rooting']['ph'] = array(
              '#type' => 'fieldset',
              '#tree' => true
            );

            $form['greenhouse']['rooting']['ph']['option'] = array(
              '#type' => 'select',
              '#title' => t('pH controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select pH control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '3')
                )
              )
            );

            $form['greenhouse']['rooting']['ph']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled pH Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[rooting][ph][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="greenhouse[rooting][ph][option]"]' => array('value' => '1')
                )
              )
            );

            $form['greenhouse']['rooting']['ph']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average pH Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[rooting][ph][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="greenhouse[rooting][ph][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        greenco2($form);
        
        greenhumidity($form);
        
        greenlight($form);

        $form['greenhouse']['temp'] = array(
          '#type' => 'fieldset',
          '#title' => t('Temperature Information:'),
          '#description' => t('Please provide temperatures in Degrees Celsius'),
          '#tree' => true,
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '3')
            )
          )
        );

        $form['greenhouse']['temp']['day'] = array(
          '#type' => 'textfield',
          '#title' => t('Average Day Temperature'),
        );

        $form['greenhouse']['temp']['night'] = array(
          '#type' => 'textfield',
          '#title' => t('Average Night Temperature'),
        );

        $form['greenhouse']['temp']['range'] = array(
          '#type' => 'textfield',
          '#title' => t('Temperature Range'),
        );
        
        $form['greenhouse']['rooting'] = array(
          '#type' => 'fieldset',
          '#title' => t('Rooting Information:'),
          '#tree' => true,
        );
        
        $form['greenhouse']['rooting']['option'] = array(
          '#type' => 'select',
          '#title' => t('Rooting Type:'),
          '#options' => array(
            0 => 'Please select a rooting type',
            1 => 'Aeroponics',
            2 => 'Hydroponics',
            3 => 'Soil',
          ),
          '#default_value' => 0,
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '3')
            )
          )
        );
        
        $form['greenhouse']['rooting']['soil'] = array(
          '#type' => 'fieldset',
          '#title' => t('Soil Information:'),
          '#states' => array(
            'visible' => array(
              ':input[name="greenhouse[rooting][option]"]' => array('value' => '3')
            )
          )
        );
        
        $form['greenhouse']['rooting']['soil']['type'] = array(
          '#type' => 'select',
          '#title' => t('Soil Type:'),
          '#options' => array(
            0 => 'Please select a soil type',
            1 => 'Sand',
            2 => 'Peat',
            3 => 'Clay',
            4 => 'Mixed',
            5 => 'Other'
          ),
          '#states' => array(
            'required' => array(
              ':input[name="greenhouse[rooting][option]"]' => array('value' => '3')
            )
          )
        );
        
        $form['greenhouse']['rooting']['soil']['other'] = array(
          '#type' => 'textfield',
          '#states' => array(
            'visible' => array(
              ':input[name="greenhouse[rooting][soil][type]"]' => array('value' => '5')
            ),
            'required' => array(
              ':input[name="greenhouse[rooting][soil][type]"]' => array('value' => '5')
            )
          )
        );
        
        $form['greenhouse']['rooting']['soil']['container'] = array(
          '#type' => 'textfield',
          '#title' => t('Soil Container Type:'),
          '#states' => array (
            'required' => array(
              ':input[name="greenhouse[rooting][option]"]' => array('value' => '3')
            )
          )
        );
        
        greenph($form);
        
        $treatment_options = drupal_map_assoc(array(
            t('Seasonal Environment'),
            t('Air temperature regime'),
            t('Soil Temperature regime'),
            t('Antibiotic regime'),
            t('Chemical administration'),
            t('Disease status'),
            t('Fertilizer regime'),
            t('Fungicide regime'),
            t('Gaseous regime'),
            t('Gravity Growth hormone regime'),
            t('Mechanical treatment'),
            t('Mineral nutrient regime'),
            t('Humidity regime'),
            t('Non-mineral nutrient regime'),
            t('Radiation (light, UV-B, X-ray) regime'),
            t('Rainfall regime'),
            t('Salt regime'),
            t('Watering regime'),
            t('Water temperature regime'),
            t('Pesticide regime'),
            t('pH regime'),
            t('other perturbation'),
          ));
        
        $form['greenhouse']['rooting']['treatment'] = array(
          '#type' => 'fieldset',
          '#title' => t('Rooting Treatments:'),
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '3')
            )
          )
        );
        
        foreach($treatment_options as $key => $option){
            $form['greenhouse']['rooting']['treatment']["$option"] = array(
              '#type' => 'checkbox',
              '#title' => t("$option")
            );
            $form['greenhouse']['rooting']['treatment']["$option-description"] = array(
              '#type' => 'textfield',
              '#description' => t("$option Description"),
              '#states' => array(
                'visible' => array(
                  ':input[name="greenhouse[rooting][treatment][' . $option . ']"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="greenhouse[rooting][treatment][' . $option . ']"]' => array('checked' => TRUE)
                )
              )
            );
        }
        
        return $form;
    }
    
    function commonGarden(&$form){
        
        function salinity(&$form){
            
            $form['commonGarden']['salinity'] = array(
              '#type' => 'fieldset',
              '#tree' => true
            );

            $form['commonGarden']['salinity']['option'] = array(
              '#type' => 'select',
              '#title' => t('Salinity controlled or uncontrolled'),
              '#options' => array(
                0 => 'Please select Salinity control',
                1 => 'Controlled',
                2 => 'Uncontrolled'
              ),
              '#default_value' => 0,
              '#states' => array(
                'required' => array(
                  ':input[name="studyType"]' => array('value' => '4')
                )
              )
            );

            $form['commonGarden']['salinity']['controlled'] = array(
              '#type' => 'textfield',
              '#title' => t('Controlled Salinity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="commonGarden[salinity][option]"]' => array('value' => '1')
                ),
                'required' => array(
                  ':input[name="commonGarden[salinity][option]"]' => array('value' => '1')
                )
              )
            );

            $form['commonGarden']['salinity']['uncontrolled'] = array(
              '#type' => 'textfield',
              '#title' => t('Average Salinity Value:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="commonGarden[salinity][option]"]' => array('value' => '2')
                ),
                'required' => array(
                  ':input[name="commonGarden[salinity][option]"]' => array('value' => '2')
                )
              )
            );
            
            return $form;
        }
        
        $form['commonGarden']['irrigation'] = array(
          '#type' => 'fieldset',
          '#tree' => true,
        );
        
        $form['commonGarden']['irrigation']['option'] = array(
          '#type' => 'select',
          '#title' => t('Irrigation type:'),
          '#options' => array(
            0 => 'Please select an irrigation type',
            1 => 'Irrigation from top',
            2 => 'Irrigation from bottom',
            3 => 'Drip Irrigation',
            4 => 'Other',
            5 => 'No Irrigation',
          ),
          '#default_value' => 0,
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '4')
            )
          )
        );
        
        $form['commonGarden']['irrigation']['other'] = array(
          '#type' => 'textfield',
          '#states' => array(
            'visible' => array(
              ':input[name="commonGarden[irrigation][option]"]' => array('value' => '4')
            ),
            'required' => array(
              ':input[name="commonGarden[irrigation][option]"]' => array('value' => '4')
            )
          )
        );
        
        salinity($form);
        
        $form['commonGarden']['bioticEnv'] = array(
          '#type' => 'fieldset',
          '#tree' => true,
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '4')
            )
          )
        );
        
        $form['commonGarden']['bioticEnv']['option'] = array(
          '#type' => 'checkboxes',
          '#title' => t('Biotic Environment'),
          '#options' => drupal_map_assoc(array(
            t('Herbivores'),
            t('Mutulists'),
            t('Pathogens'),
            t('Endophytes'),
            t('Other'),
            t('None'),
          )),
        );
        
        $form['commonGarden']['bioticEnv']['other'] = array(
          '#type' => 'textfield',
          '#title' => t('Please specify Biotic Environment Type:'),
          '#states' => array(
            'visible' => array(
              ':input[name="commonGarden[bioticEnv][option][Other]"]' => array('checked' => TRUE)
            ),
            'required' => array(
              ':input[name="commonGarden[bioticEnv][option][Other]"]' => array('checked' => TRUE)
            )
          )
        );
        
        $form['commonGarden']['season'] = array(
          '#type' => 'checkboxes',
          '#title' => t('Seasons:'),
          '#options' => drupal_map_assoc(array(
            t('Spring'),
            t('Summer'),
            t('Fall'),
            t('Winter'),
          )),
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '4')
            )
          )
        );
        
        $treatment_options = drupal_map_assoc(array(
            t('Seasonal environment'),
            t('Antibiotic regime'),
            t('Chemical administration'),
            t('Disease status'),
            t('Fertilizer regime'),
            t('Fungicide regime'),
            t('Gaseous regime'),
            t('Gravity Growth hormone regime'),
            t('Herbicide regime'),
            t('Mechanical treatment'),
            t('Mineral nutrient regime'),
            t('Non-mineral nutrient regime'),
            t('Salt regime'),
            t('Watering regime'),
            t('Pesticide regime'),
            t('pH regime'),
            t('Other perturbation')
          ));
        
        $form['commonGarden']['treatment'] = array(
          '#type' => 'fieldset',
          '#title' => t('Treatments:'),
          '#states' => array(
            'required' => array(
              ':input[name="studyType"]' => array('value' => '4')
            )
          )
        );
        
        foreach($treatment_options as $key => $option){
            $form['commonGarden']['treatment']["$option"] = array(
              '#type' => 'checkbox',
              '#title' => t("$option")
            );
            $form['commonGarden']['treatment']["$option-description"] = array(
              '#type' => 'textfield',
              '#description' => t("$option Description"),
              '#states' => array(
                'visible' => array(
                  ':input[name="commonGarden[treatment][' . $option . ']"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="commonGarden[treatment][' . $option . ']"]' => array('checked' => TRUE)
                )
              )
            );
        }
        
        return $form;
    }
    
    studyDate('Starting', $form);
    
    studyDate('Ending', $form);
    
    studyLocation($form);

    $form['studyType'] = array(
      '#type' => 'select',
      '#title' => t('Study Type:'),
      '#options' => array(
        0 => 'Please select the type of study',
        1 => 'Natural Population (Landscape)',
        2 => 'Growth Chamber',
        3 => 'Greenhouse',
        4 => 'Experimental/Common Garden',
        5 => 'Plantation',
      ),
      '#default_value' => 0,
      '#required' => true,
    );

    $form['naturalPopulation'] = array(
      '#type' => 'fieldset',
      '#title' => t('Natural Population/Landscape Information:'),
      '#tree' => TRUE,
      '#states' => array(
        'visible' => array(
          ':input[name="studyType"]' => array('value' => '1')
        ),
        'required' => array(
          ':input[name="studyType"]' => array('value' => '1')
        ),
        'enabled' => array(
          ':input[name="studyType"]' => array('value' => '1')
        )
      )
    );
    
    naturalPopulation($form);
    
    $form['growthChamber'] = array(
      '#type' => 'fieldset',
      '#title' => t('Growth Chamber Information:'),
      '#tree' => TRUE,
      '#states' => array(
        'visible' => array(
          ':input[name="studyType"]' => array('value' => '2')
        ),
        'enabled' => array(
          ':input[name="studyType"]' => array('value' => '2')
        )
      )
    );
    
    growthChamber($form);
    
    $form['greenhouse'] = array(
      '#type' => 'fieldset',
      '#title' => t('Greenhouse Information:'),
      '#tree' => TRUE,
      '#states' => array(
        'visible' => array(
          ':input[name="studyType"]' => array('value' => '3')
        ),
        'enabled' => array(
          ':input[name="studyType"]' => array('value' => '3')
        )
      )
    );
    
    greenhouse($form);
    
    $form['commonGarden'] = array(
      '#type' => 'fieldset',
      '#title' => t('Common Garden Information:'),
      '#tree' => TRUE,
      '#states' => array(
        'visible' => array(
          ':input[name="studyType"]' => array('value' => '4')
        ),
        'enabled' => array(
          ':input[name="studyType"]' => array('value' => '4')
        )
      )
    );
    
    commonGarden($form);
    
    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => t('Submit'),
    );

    drupal_add_js(drupal_get_path('module', 'custom_module') . "/custom_module.js");

    return $form;
}

function custom_module_showCustomModuleForm_second_page_validate($form, &$form_state) {
    /*$studyType = $form_state['values']['studyType'];
    
    $CO2 = $form_state['values']['growthChamberCO2'];
    $UncontrolledCO2 = $form_state['values']['growthChamber_CO2Controlled'];
    $ControlledCO2 = $form_state['values']['growthChamber_CO2Controlled'];
    
    $airHumidity = $form_state['values']['growthChamberAirHumidity'];
    $controlledairHumidity = $form_state['values']['growthChamber_AirHumidityControlled'];
    $controlledairHumidity = $form_state['values']['growthChamber_AirHumidityUncontrolled'];
    
    $lightIntensity = $form_state['values']['growthChamberLightIntensity'];
    $controlledLightIntensity = $form_state['values']['growthChamber_LightIntensityControlled'];
    
    
    $soil = $form_state['values']['growthChamberSoil'];
    $soilType = $form_state['values']['growthChamber_SoilType'];
    $soilContainerType = $form_state['values']['growthChamber_SoilContainerType'];
    
    if ($studyType == 'Growth Chamber'){
        
        if ($CO2 == 'Controlled' && $ControlledCO2 == '') {
            form_set_error('Please input a value for controlled CO2');
            
        }
        
        else if ($CO2 == 'Uncontrolled' && $UncontrolledCO2 == ''){
            form_set_error('Please input a value for uncontrolled CO2');
    }
    
        if ($airHumidity == 'Controlled' && $controlledairHumidity == ''){
            form_set_error('Please input a value for controlled air humidity');
        }
        
        elseif($airHumidity == 'Uncontrolled' && $UncontrolledCO2 == ''){
            form_set_error('Please input a value for uncontrolled air humidity');
        }
        
        if ($lightIntensity == 'Controlled' && $controlledLightIntensity == ''){
            form_set_error('Please input a value for light intensity');
        }
        
    
    elseif ($studyType == 'Experimental/Common Garden'){
        
    }
    else{
        
    }
}*/

    }

function custom_module_showCustomModuleForm_second_page_submit($form, &$form_state) {
   $startMonth = $form_state['values']['startingDate'][1]['Month'];
   $startYear = $form_state['values']['startingDate'][1]['Year'];
   $startDay = $form_state['values']['startingDate'][1]['Day'];
   
   $endMonth = $form_state['values']['endingDate'][1]['Month'];
   $endYear = $form_state['values']['endingDate'][1]['Year'];
   $endDay = $form_state['values']['endingDate'][1]['Day'];
   
   $location = $form_state['values']['location'];
   $studyType = $form_state['values']['studyType'];
    
   $form_state['redirect'] = 'thirdPage';
   
   
   
   
   
   

//    To be implemented
}

function custom_module_showCustomModuleForm_third_page() {
    
    $form['dataType'] = array(
      '#type' => 'select',
      '#title' => t('Please select data type'),
      '#options' => array(
        'Genotype x Phenotype',
        'Genotype',
        'Genotype x Phenotype x Environment',
        'Phenotype x Environment',
        'Genotype x Environment'
      ),
      '#required' => TRUE,
    );
    
    function tree_access(&$form){
        
        $form['tree-access'] = array(
          '#type' => 'fieldset',
          '#title' => t('Tree Accession Information'),
          '#tree' => TRUE
        );

        $form['tree-access']['identifier'] = array(
          '#type' => 'textfield',
          '#title' => t('Identifier'),
          '#required' => TRUE
        );

        $form['tree-access']['location']['type'] = array(
          '#type' => 'select',
          '#title' => t('Location Type'),
          '#options' => array(
            0 => 'Please select a location type',
            1 => 'Latitude/Longitude',
            2 => 'Custom Location'
          )
        );

        $form['tree-access']['location']['latitude'] = array(
          '#type' => 'textfield',
          '#title' => t('Latitude'),
          '#states' => array(
            'visible' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '1')
            ),
            'required' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '1')
            ),
            'disabled' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '2')
            )
          ),
        );

        $form['tree-access']['location']['longitude'] = array(
          '#type' => 'textfield',
          '#title' => t('Longitude'),
          '#states' => array(
            'visible' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '1')
            ),
            'required' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '1')
            ),
            'disabled' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '2')
            )
          ),
        );

        $form['tree-access']['location']['customLocation'] = array(
          '#type' => 'textfield',
          '#title' => t('Enter a custom location'),
          '#states' => array(
            'visible' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '2')
            ),
            'required' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '2')
            ),
            'disabled' => array(
              ':input[name="tree-access[location][type]"]' => array('value' => '1')
            )
          ),
        );

        $form['tree-access']['age'] = array(
          '#type' => 'textfield',
          '#title' => t('Age and development Stage'),
          '#required' => TRUE
        );

        $form['tree-access']['tissue'] = array(
          '#type' => 'select',
          '#title' => t('Tissue types'),
          '#options' => array(
            'Tissue 1',
            'Tissue 2'
          ),
        );

        $form['tree-access']['clone'] = array(
          '#type' => 'textfield',
          '#title' => t('Clone and or pedigree information')
        );
        
        return $form;
    }
    
    function phenotype(&$form){
        
        $num_pheno = array();
        
        for($i = 0; $i < 20; $i++){
            $num_pheno[$i] = $i + 1;
        }
        $num_pheno[20] = '>20';

        $form['phenotype'] = array(
          '#type' => 'fieldset',
          '#title' => t('Phenotype Information:'),
          '#tree' => TRUE,
          '#states' => array(
            'visible' => array(
              array(
                array(':input[name="dataType"]' => array('value' => '0')),
                'or',
                array(':input[name="dataType"]' => array('value' => '2')),
                'or',
                array(':input[name="dataType"]' => array('value' => '3')),
              )
            ),
            'required' => array(
              array(
                array(':input[name="dataType"]' => array('value' => '0')),
                'or',
                array(':input[name="dataType"]' => array('value' => '2')),
                'or',
                array(':input[name="dataType"]' => array('value' => '3')),
              )
            )
          )
        );

        $form['phenotype']['number'] = array(
          '#type' => 'select',
          '#title' => t('Number of Phenotypes'),
          '#options' => $num_pheno,
        );

        for($i = 0; $i < 20; $i++){

            $visible_values = array();
            array_push($visible_values, array(':input[name="phenotype[number]"]' => array('value' => "$i")));

            for ($j = $i + 1; $j < 20; $j++){
                array_push($visible_values, 'or');
                array_push($visible_values, array(':input[name="phenotype[number]"]' => array('value' => "$j")));
            }

            $phenotype_label = $i + 1;
            $form['phenotype'][$i] = array(
              '#type' => 'fieldset',
              '#title' => t("Phenotype $phenotype_label"),
              '#states' => array(
                'visible' => array($visible_values)
              )
            );

            $form['phenotype'][$i]['name'] = array(
              '#type' => 'textfield',
              '#title' => t('Name'),
            );

            $form['phenotype'][$i]['phenotype_or_environmental'] = array(
              '#type' => 'radios',
              '#title' => t('Phenotype or Environmental Variable:'),
              '#options' => array(
                0 => t('Phenotype'),
                1 => t('Environmental Variable'),
              ),
            );

            $form['phenotype'][$i]['type'] = array(
              '#type' => 'select',
              '#title' => t('Type'),
              '#options' => array(
                0 => 'Please select a type',
                1 => 'Binary',
                2 => 'Quantitative',
                3 => 'Qualitative'
              ),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );

            $form['phenotype'][$i]['binary'] = array(
              '#type' => 'fieldset',
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][type]"]' => array('value' => '1')
                )
              ),
            );

            $form['phenotype'][$i]['binary'][1] = array(
              '#type' => 'textfield',
              '#title' => t('Type 1:'),
            );

            $form['phenotype'][$i]['binary'][2] = array(
              '#type' => 'textfield',
              '#title' => t('Type 2:'),
            );

            $form['phenotype'][$i]['quantitative'] = array(
              '#type' => 'fieldset',
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][type]"]' => array('value' => '2')
                )
              ),
            );

            $form['phenotype'][$i]['quantitative']['min'] = array(
              '#type' => 'textfield',
              '#title' => t('Minimum value:'),
            );

            $form['phenotype'][$i]['quantitative']['max'] = array(
              '#type' => 'textfield',
              '#title' => t('Maximum value:'),
            );

            $form['phenotype'][$i]['description'] = array(
              '#type' => 'textarea',
              '#title' => t('Please provide a short description of your phenotype:'),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );

            $form['phenotype'][$i]['units'] = array(
              '#type' => 'select',
              '#title' => t('Units:'),
              '#options' => array(
                0 => 'Please select a unit type',
                1 => 'mm',
                2 => 'cm',
                3 => 'm',
                4 => 'Degrees Celsius',
                5 => 'Degrees Fahrenheit',
                6 => 'Other'
              ),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );

            $form['phenotype'][$i]['units-other'] = array(
              '#type' => 'textfield',
              '#title' => t('Define Unit type'),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][units]"]' => array('value' => '6')
                )
              )
            );
            
            $form['phenotype'][$i]['structure'] = array(
              '#type' => 'textfield',
              '#title' => t('Plant Structure:'),
              '#description' => t('Please choose a term that describes the plant structure the phenotype was measured on.'),
              '#autocomplete_path' => 'structure/autocomplete',
              '#maxlength' => 128,
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );
            
            $form['phenotype'][$i]['structure-custom'] = array(
              '#type' => 'fieldset',
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );
            
            $form['phenotype'][$i]['structure-custom']['check'] = array(
              '#type' => 'checkbox',
              '#title' => t('None of these terms meet my needs')
            );
            
            $form['phenotype'][$i]['structure-custom']['term'] = array(
              '#type' => 'textfield',
              '#title' => t('Please enter the name of your custom term'),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][structure-custom][check]"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="phenotype[' . $i . '][structure-custom][check]"]' => array('checked' => TRUE)
                ),
              )
            );
            
            $form['phenotype'][$i]['structure-custom']['definition'] = array(
              '#type' => 'textfield',
              '#title' => t('Please enter the definition of your custom term'),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][structure-custom][check]"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="phenotype[' . $i . '][structure-custom][check]"]' => array('checked' => TRUE)
                ),
              )
            );
            
            $form['phenotype'][$i]['developmental'] = array(
              '#type' => 'textfield',
              '#title' => t('Developmental Stage:'),
              '#description' => t('Please choose a term that describes the developmental stage the phenotype was measured on.'),
              '#autocomplete_path' => 'developmental/autocomplete',
              '#maxlength' => 128,
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );
            
            $form['phenotype'][$i]['developmental-custom'] = array(
              '#type' => 'fieldset',
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][phenotype_or_environmental]"]' => array('value' => '0')
                )
              )
            );
            
            $form['phenotype'][$i]['developmental-custom']['check'] = array(
              '#type' => 'checkbox',
              '#title' => t('None of these terms meet my needs')
            );
            
            $form['phenotype'][$i]['developmental-custom']['term'] = array(
              '#type' => 'textfield',
              '#title' => t('Please enter the name of your custom term'),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][developmental-custom][check]"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="phenotype[' . $i . '][developmental-custom][check]"]' => array('checked' => TRUE)
                ),
              )
            );
            
            $form['phenotype'][$i]['developmental-custom']['definition'] = array(
              '#type' => 'textfield',
              '#title' => t('Please enter the definition of your custom term'),
              '#states' => array(
                'visible' => array(
                  ':input[name="phenotype[' . $i . '][developmental-custom][check]"]' => array('checked' => TRUE)
                ),
                'required' => array(
                  ':input[name="phenotype[' . $i . '][developmental-custom][check]"]' => array('checked' => TRUE)
                ),
              )
            );
        }

        $form['phenotype']['upload'] = array(
          '#type' => 'file',
          '#title' => t('Phenotype file'),
          '#title_display' => 'invisible',
          '#states' => array( 
            'visible' => array(
              ':input[name="phenotype[number]"]' => array('value' => '20')
            )
          )
        );
        
        return $form;
    }
    
    function genotype(&$form){
        
        $form['genotype'] = array(
          '#type' => 'fieldset',
          '#title' => t('Genotype Information:'),
          '#tree' => TRUE,
          '#states' => array(
            'visible' => array(
              array(
                array(':input[name="dataType"]' => array('value' => '0')),
                'or',
                array(':input[name="dataType"]' => array('value' => '1')),
                'or',
                array(':input[name="dataType"]' => array('value' => '2')),
                'or',
                array(':input[name="dataType"]' => array('value' => '4')),
              )
            )
          )
        );
        
        //need to change this to 'checkboxes'
        //will also need to change states values in the sections that depend on this menu
        $form['genotype']['marker-type'] = array(
          '#type' => 'select',
          '#title' => t('Marker Type:'),
          '#options' => array(
            0 => 'Please select a Marker type',
            1 => 'SNPs',
            2 => 'SSRs/cpSSRs',
            3 => 'Other',
          )
        );

        $form['genotype']['SNPs'] = array(
          '#type' => 'fieldset',
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[marker-type]"]' => array('value' => '1')
            )
          )
        );

        $form['genotype']['SNPs']['genotyping-design'] = array(
          '#type' => 'select',
          '#title' => t('Define Genotyping Design'),
          '#options' => array(
            0 => 'Please select a Genotyping Design',
            1 => 'GBS',
            2 => 'Targeted Capture',
            3 => 'Whole Genome Resequencing',
            4 => 'RNA-Seq',
            5 => 'Genotyping Array'
          )
        );

        $form['genotype']['SNPs']['GBS'] = array(
          '#type' => 'select',
          '#title' => t('GBS Type'),
          '#options' => array(
            0 => 'Please select a GBS type',
            1 => 'RADSeq',
            2 => 'ddRAD-Seq',
            3 => 'NextRAD',
            4 => 'RAPTURE',
            5 => 'Other'
          ),
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[SNPs][genotyping-design]"]' => array('value' => '1')
            )
          )
        );

        $form['genotype']['SNPs']['GBS-other'] = array(
          '#type' => 'textfield',
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[SNPs][GBS]"]' => array('value' => '5'),
              ':input[name="genotype[SNPs][genotyping-design]"]' => array('value' => '1')
            )
          )
        );

        $form['genotype']['SNPs']['targeted-capture'] = array(
          '#type' => 'select',
          '#title' => t('Targeted Capture Type'),
          '#options' => array(
            0 => 'Please select a Targeted Capture Type',
            1 => 'Exome Capture',
            2 => 'Other'
          ),
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[SNPs][genotyping-design]"]' => array('value' => '2')
            )
          )
        );

        $form['genotype']['SNPs']['targeted-capture-other'] = array(
          '#type' => 'textfield',
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[SNPs][targeted-capture]"]' => array('value' => '2'),
              ':input[name="genotype[SNPs][genotyping-design]"]' => array('value' => '2')
            )
          )
        );

        $form['genotype']['SNPs']['bioproject'] = array(
          '#type' => 'textfield',
          '#title' => 'BioProject ID:'
        );

        $form['genotype']['SNPs']['SNP-file-type'] = array(
          '#type' => 'select',
          '#title' => 'SNP File:',
          '#options' => array(
            0 => 'Please select an SNP file type',
            1 => '.VCF',
            2 => 'Spreadsheet',
          )
        );

        $form['genotype']['SNPs']['SNP-VCF'] = array(
          '#type' => 'file',
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[SNPs][SNP-file-type]"]' => array('value' => '1')
            )
          )
        );

        $form['genotype']['SNPs']['SNP-spreadsheet'] = array(
          '#type' => 'file',
          '#description' => t('Please provide a spreadsheet with the following columns:<br>'
              . '   SNP Name<br>   Type(indel/SNP)<br>   Location<br>   Quality Score<br>   Allele/Reference Allele<br><br>'
              . 'Optional columns:<br>'
              . '   Coverage Depth<br>   Mapping Quality Score<br>'),
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[SNPs][SNP-file-type]"]' => array('value' => '2')
            )
          )
        );

        $form['genotype']['SSRs/cpSSRs'] = array(
          '#type' => 'fieldset',
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[marker-type]"]' => array('value' => '2')
            )
          )
        );

        $form['genotype']['SSRs/cpSSRs']['define-type'] = array(
          '#type' => 'textfield',
          '#title' => t('Define Type:'),
        );

        $form['genotype']['SSRs/cpSSRs']['load-file'] = array(
          '#type' => 'file',
          '#title' => t('Load File with primer information and marker for each individual genotype:'),
        );

        $form['genotype']['other'] = array(
          '#type' => 'fieldset',
          '#states' => array(
            'visible' => array(
              ':input[name="genotype[marker-type]"]' => array('value' => '3')
            )
          )
        );

        $form['genotype']['other']['define-type'] = array(
          '#type' => 'textfield',
          '#title' => t('Define Type:'),
        );

        $form['genotype']['other']['load-file'] = array(
          '#type' => 'file',
          '#title' => t('Load File:')
        );
        
        return $form;
    };
    
    tree_access($form);
    
    phenotype($form);
    
    genotype($form);
    
    $form['submit'] = array(
      '#type' => 'submit',
      '#title' => t('Submit'),
      '#value' => t('Submit')
    );

    drupal_add_js(drupal_get_path('module', 'custom_module') . "/custom_module.js");
    
    return $form;
}

function custom_module_showCustomModuleForm_third_page_validate($form, &$form_state){

}

function custom_module_showCustomModuleForm_third_page_submit($form, &$form_state) {
    $form_state['redirect'] = 'fourthPage';
}

function _structure_autocomplete($string){
    $matches = array();
    $result = db_select('chado.cv', 'cv')
        ->fields('cv', array('name', 'definition'))
        ->condition('name', '%' . db_like($string) . '%', 'LIKE')
        ->execute();
    
    foreach($result as $row){
        if ($row->definition != ""){
            $matches[$row->name] = check_plain($row->name . ":  " . $row->definition);
        }
        else{
            $matches[$row->name] = check_plain($row->name . ":  No definition on record");
        }
    }
    
    drupal_json_output($matches);
}

function _development_autocomplete($string){
    $matches = array();
    $result = db_select('chado.cv', 'cv')
        ->fields('cv', array('name', 'definition'))
        ->condition('name', '%' . db_like($string) . '%', 'LIKE')
        ->execute();
    
    foreach($result as $row){
        if ($row->definition != ""){
            $matches[$row->name] = check_plain($row->name . ":  " . $row->definition);
        }
        else{
            $matches[$row->name] = check_plain($row->name . ":  No definition on record");
        }
    }
    
    drupal_json_output($matches);
}

function custom_module_showCustomModuleForm_fourth_page_submit($form, &$form_state) {
    $form_state['redirect'] = 'fourthPage';
}